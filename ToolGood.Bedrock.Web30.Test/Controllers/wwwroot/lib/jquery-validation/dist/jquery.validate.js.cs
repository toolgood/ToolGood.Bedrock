using Microsoft.AspNetCore.Mvc;
using System;
namespace ToolGood.WwwRoot.Test
{
    public partial class WwwRootController : Controller
    {
        [HttpGet("lib/jquery-validation/dist/jquery.validate.js")]
        public IActionResult lib_jquery_validation_dist_jquery_validate_js()
        {
            if (Request.Headers["If-None-Match"]  == "2C935282519FA3A67E60C927B60F9142") {
                Response.Headers["Expires"] = DateTime.Now.AddYears(100).ToString("r");
                return StatusCode(304);
            }
            Response.Headers["Cache-Control"] = "max-age=315360000";
            Response.Headers["Etag"] = "2C935282519FA3A67E60C927B60F9142";
            Response.Headers["Date"] = DateTime.Now.ToString("r");
            Response.Headers["Expires"] = DateTime.Now.AddYears(100).ToString("r");
            const string s = "LyohDQogKiBqUXVlcnkgVmFsaWRhdGlvbiBQbHVnaW4gdjEuMTcuMA0KICoNCiAqIGh0dHBzOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE3IErDtnJuIFphZWZmZXJlcg0KICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlDQogKi8NCihmdW5jdGlvbiggZmFjdG9yeSApIHsNCglpZiAoIHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCApIHsNCgkJZGVmaW5lKCBbImpxdWVyeSJdLCBmYWN0b3J5ICk7DQoJfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlID09PSAib2JqZWN0IiAmJiBtb2R1bGUuZXhwb3J0cykgew0KCQltb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoIHJlcXVpcmUoICJqcXVlcnkiICkgKTsNCgl9IGVsc2Ugew0KCQlmYWN0b3J5KCBqUXVlcnkgKTsNCgl9DQp9KGZ1bmN0aW9uKCAkICkgew0KDQokLmV4dGVuZCggJC5mbiwgew0KDQoJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy92YWxpZGF0ZS8NCgl2YWxpZGF0ZTogZnVuY3Rpb24oIG9wdGlvbnMgKSB7DQoNCgkJLy8gSWYgbm90aGluZyBpcyBzZWxlY3RlZCwgcmV0dXJuIG5vdGhpbmc7IGNhbid0IGNoYWluIGFueXdheQ0KCQlpZiAoICF0aGlzLmxlbmd0aCApIHsNCgkJCWlmICggb3B0aW9ucyAmJiBvcHRpb25zLmRlYnVnICYmIHdpbmRvdy5jb25zb2xlICkgew0KCQkJCWNvbnNvbGUud2FybiggIk5vdGhpbmcgc2VsZWN0ZWQsIGNhbid0IHZhbGlkYXRlLCByZXR1cm5pbmcgbm90aGluZy4iICk7DQoJCQl9DQoJCQlyZXR1cm47DQoJCX0NCg0KCQkvLyBDaGVjayBpZiBhIHZhbGlkYXRvciBmb3IgdGhpcyBmb3JtIHdhcyBhbHJlYWR5IGNyZWF0ZWQNCgkJdmFyIHZhbGlkYXRvciA9ICQuZGF0YSggdGhpc1sgMCBdLCAidmFsaWRhdG9yIiApOw0KCQlpZiAoIHZhbGlkYXRvciApIHsNCgkJCXJldHVybiB2YWxpZGF0b3I7DQoJCX0NCg0KCQkvLyBBZGQgbm92YWxpZGF0ZSB0YWcgaWYgSFRNTDUuDQoJCXRoaXMuYXR0ciggIm5vdmFsaWRhdGUiLCAibm92YWxpZGF0ZSIgKTsNCg0KCQl2YWxpZGF0b3IgPSBuZXcgJC52YWxpZGF0b3IoIG9wdGlvbnMsIHRoaXNbIDAgXSApOw0KCQkkLmRhdGEoIHRoaXNbIDAgXSwgInZhbGlkYXRvciIsIHZhbGlkYXRvciApOw0KDQoJCWlmICggdmFsaWRhdG9yLnNldHRpbmdzLm9uc3VibWl0ICkgew0KDQoJCQl0aGlzLm9uKCAiY2xpY2sudmFsaWRhdGUiLCAiOnN1Ym1pdCIsIGZ1bmN0aW9uKCBldmVudCApIHsNCg0KCQkJCS8vIFRyYWNrIHRoZSB1c2VkIHN1Ym1pdCBidXR0b24gdG8gcHJvcGVybHkgaGFuZGxlIHNjcmlwdGVkDQoJCQkJLy8gc3VibWl0cyBsYXRlci4NCgkJCQl2YWxpZGF0b3Iuc3VibWl0QnV0dG9uID0gZXZlbnQuY3VycmVudFRhcmdldDsNCg0KCQkJCS8vIEFsbG93IHN1cHByZXNzaW5nIHZhbGlkYXRpb24gYnkgYWRkaW5nIGEgY2FuY2VsIGNsYXNzIHRvIHRoZSBzdWJtaXQgYnV0dG9uDQoJCQkJaWYgKCAkKCB0aGlzICkuaGFzQ2xhc3MoICJjYW5jZWwiICkgKSB7DQoJCQkJCXZhbGlkYXRvci5jYW5jZWxTdWJtaXQgPSB0cnVlOw0KCQkJCX0NCg0KCQkJCS8vIEFsbG93IHN1cHByZXNzaW5nIHZhbGlkYXRpb24gYnkgYWRkaW5nIHRoZSBodG1sNSBmb3Jtbm92YWxpZGF0ZSBhdHRyaWJ1dGUgdG8gdGhlIHN1Ym1pdCBidXR0b24NCgkJCQlpZiAoICQoIHRoaXMgKS5hdHRyKCAiZm9ybW5vdmFsaWRhdGUiICkgIT09IHVuZGVmaW5lZCApIHsNCgkJCQkJdmFsaWRhdG9yLmNhbmNlbFN1Ym1pdCA9IHRydWU7DQoJCQkJfQ0KCQkJfSApOw0KDQoJCQkvLyBWYWxpZGF0ZSB0aGUgZm9ybSBvbiBzdWJtaXQNCgkJCXRoaXMub24oICJzdWJtaXQudmFsaWRhdGUiLCBmdW5jdGlvbiggZXZlbnQgKSB7DQoJCQkJaWYgKCB2YWxpZGF0b3Iuc2V0dGluZ3MuZGVidWcgKSB7DQoNCgkJCQkJLy8gUHJldmVudCBmb3JtIHN1Ym1pdCB0byBiZSBhYmxlIHRvIHNlZSBjb25zb2xlIG91dHB1dA0KCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCX0NCgkJCQlmdW5jdGlvbiBoYW5kbGUoKSB7DQoJCQkJCXZhciBoaWRkZW4sIHJlc3VsdDsNCg0KCQkJCQkvLyBJbnNlcnQgYSBoaWRkZW4gaW5wdXQgYXMgYSByZXBsYWNlbWVudCBmb3IgdGhlIG1pc3Npbmcgc3VibWl0IGJ1dHRvbg0KCQkJCQkvLyBUaGUgaGlkZGVuIGlucHV0IGlzIGluc2VydGVkIGluIHR3byBjYXNlczoNCgkJCQkJLy8gICAtIEEgdXNlciBkZWZpbmVkIGEgYHN1Ym1pdEhhbmRsZXJgDQoJCQkJCS8vICAgLSBUaGVyZSB3YXMgYSBwZW5kaW5nIHJlcXVlc3QgZHVlIHRvIGByZW1vdGVgIG1ldGhvZCBhbmQgYHN0b3BSZXF1ZXN0KClgDQoJCQkJCS8vICAgICB3YXMgY2FsbGVkIHRvIHN1Ym1pdCB0aGUgZm9ybSBpbiBjYXNlIGl0J3MgdmFsaWQNCgkJCQkJaWYgKCB2YWxpZGF0b3Iuc3VibWl0QnV0dG9uICYmICggdmFsaWRhdG9yLnNldHRpbmdzLnN1Ym1pdEhhbmRsZXIgfHwgdmFsaWRhdG9yLmZvcm1TdWJtaXR0ZWQgKSApIHsNCgkJCQkJCWhpZGRlbiA9ICQoICI8aW5wdXQgdHlwZT0naGlkZGVuJy8+IiApDQoJCQkJCQkJLmF0dHIoICJuYW1lIiwgdmFsaWRhdG9yLnN1Ym1pdEJ1dHRvbi5uYW1lICkNCgkJCQkJCQkudmFsKCAkKCB2YWxpZGF0b3Iuc3VibWl0QnV0dG9uICkudmFsKCkgKQ0KCQkJCQkJCS5hcHBlbmRUbyggdmFsaWRhdG9yLmN1cnJlbnRGb3JtICk7DQoJCQkJCX0NCg0KCQkJCQlpZiAoIHZhbGlkYXRvci5zZXR0aW5ncy5zdWJtaXRIYW5kbGVyICkgew0KCQkJCQkJcmVzdWx0ID0gdmFsaWRhdG9yLnNldHRpbmdzLnN1Ym1pdEhhbmRsZXIuY2FsbCggdmFsaWRhdG9yLCB2YWxpZGF0b3IuY3VycmVudEZvcm0sIGV2ZW50ICk7DQoJCQkJCQlpZiAoIGhpZGRlbiApIHsNCg0KCQkJCQkJCS8vIEFuZCBjbGVhbiB1cCBhZnRlcndhcmRzOyB0aGFua3MgdG8gbm8tYmxvY2stc2NvcGUsIGhpZGRlbiBjYW4gYmUgcmVmZXJlbmNlZA0KCQkJCQkJCWhpZGRlbi5yZW1vdmUoKTsNCgkJCQkJCX0NCgkJCQkJCWlmICggcmVzdWx0ICE9PSB1bmRlZmluZWQgKSB7DQoJCQkJCQkJcmV0dXJuIHJlc3VsdDsNCgkJCQkJCX0NCgkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJfQ0KCQkJCQlyZXR1cm4gdHJ1ZTsNCgkJCQl9DQoNCgkJCQkvLyBQcmV2ZW50IHN1Ym1pdCBmb3IgaW52YWxpZCBmb3JtcyBvciBjdXN0b20gc3VibWl0IGhhbmRsZXJzDQoJCQkJaWYgKCB2YWxpZGF0b3IuY2FuY2VsU3VibWl0ICkgew0KCQkJCQl2YWxpZGF0b3IuY2FuY2VsU3VibWl0ID0gZmFsc2U7DQoJCQkJCXJldHVybiBoYW5kbGUoKTsNCgkJCQl9DQoJCQkJaWYgKCB2YWxpZGF0b3IuZm9ybSgpICkgew0KCQkJCQlpZiAoIHZhbGlkYXRvci5wZW5kaW5nUmVxdWVzdCApIHsNCgkJCQkJCXZhbGlkYXRvci5mb3JtU3VibWl0dGVkID0gdHJ1ZTsNCgkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJfQ0KCQkJCQlyZXR1cm4gaGFuZGxlKCk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJdmFsaWRhdG9yLmZvY3VzSW52YWxpZCgpOw0KCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJfQ0KCQkJfSApOw0KCQl9DQoNCgkJcmV0dXJuIHZhbGlkYXRvcjsNCgl9LA0KDQoJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy92YWxpZC8NCgl2YWxpZDogZnVuY3Rpb24oKSB7DQoJCXZhciB2YWxpZCwgdmFsaWRhdG9yLCBlcnJvckxpc3Q7DQoNCgkJaWYgKCAkKCB0aGlzWyAwIF0gKS5pcyggImZvcm0iICkgKSB7DQoJCQl2YWxpZCA9IHRoaXMudmFsaWRhdGUoKS5mb3JtKCk7DQoJCX0gZWxzZSB7DQoJCQllcnJvckxpc3QgPSBbXTsNCgkJCXZhbGlkID0gdHJ1ZTsNCgkJCXZhbGlkYXRvciA9ICQoIHRoaXNbIDAgXS5mb3JtICkudmFsaWRhdGUoKTsNCgkJCXRoaXMuZWFjaCggZnVuY3Rpb24oKSB7DQoJCQkJdmFsaWQgPSB2YWxpZGF0b3IuZWxlbWVudCggdGhpcyApICYmIHZhbGlkOw0KCQkJCWlmICggIXZhbGlkICkgew0KCQkJCQllcnJvckxpc3QgPSBlcnJvckxpc3QuY29uY2F0KCB2YWxpZGF0b3IuZXJyb3JMaXN0ICk7DQoJCQkJfQ0KCQkJfSApOw0KCQkJdmFsaWRhdG9yLmVycm9yTGlzdCA9IGVycm9yTGlzdDsNCgkJfQ0KCQlyZXR1cm4gdmFsaWQ7DQoJfSwNCg0KCS8vIGh0dHBzOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvcnVsZXMvDQoJcnVsZXM6IGZ1bmN0aW9uKCBjb21tYW5kLCBhcmd1bWVudCApIHsNCgkJdmFyIGVsZW1lbnQgPSB0aGlzWyAwIF0sDQoJCQlzZXR0aW5ncywgc3RhdGljUnVsZXMsIGV4aXN0aW5nUnVsZXMsIGRhdGEsIHBhcmFtLCBmaWx0ZXJlZDsNCg0KCQkvLyBJZiBub3RoaW5nIGlzIHNlbGVjdGVkLCByZXR1cm4gZW1wdHkgb2JqZWN0OyBjYW4ndCBjaGFpbiBhbnl3YXkNCgkJaWYgKCBlbGVtZW50ID09IG51bGwgKSB7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQlpZiAoICFlbGVtZW50LmZvcm0gJiYgZWxlbWVudC5oYXNBdHRyaWJ1dGUoICJjb250ZW50ZWRpdGFibGUiICkgKSB7DQoJCQllbGVtZW50LmZvcm0gPSB0aGlzLmNsb3Nlc3QoICJmb3JtIiApWyAwIF07DQoJCQllbGVtZW50Lm5hbWUgPSB0aGlzLmF0dHIoICJuYW1lIiApOw0KCQl9DQoNCgkJaWYgKCBlbGVtZW50LmZvcm0gPT0gbnVsbCApIHsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCWlmICggY29tbWFuZCApIHsNCgkJCXNldHRpbmdzID0gJC5kYXRhKCBlbGVtZW50LmZvcm0sICJ2YWxpZGF0b3IiICkuc2V0dGluZ3M7DQoJCQlzdGF0aWNSdWxlcyA9IHNldHRpbmdzLnJ1bGVzOw0KCQkJZXhpc3RpbmdSdWxlcyA9ICQudmFsaWRhdG9yLnN0YXRpY1J1bGVzKCBlbGVtZW50ICk7DQoJCQlzd2l0Y2ggKCBjb21tYW5kICkgew0KCQkJY2FzZSAiYWRkIjoNCgkJCQkkLmV4dGVuZCggZXhpc3RpbmdSdWxlcywgJC52YWxpZGF0b3Iubm9ybWFsaXplUnVsZSggYXJndW1lbnQgKSApOw0KDQoJCQkJLy8gUmVtb3ZlIG1lc3NhZ2VzIGZyb20gcnVsZXMsIGJ1dCBhbGxvdyB0aGVtIHRvIGJlIHNldCBzZXBhcmF0ZWx5DQoJCQkJZGVsZXRlIGV4aXN0aW5nUnVsZXMubWVzc2FnZXM7DQoJCQkJc3RhdGljUnVsZXNbIGVsZW1lbnQubmFtZSBdID0gZXhpc3RpbmdSdWxlczsNCgkJCQlpZiAoIGFyZ3VtZW50Lm1lc3NhZ2VzICkgew0KCQkJCQlzZXR0aW5ncy5tZXNzYWdlc1sgZWxlbWVudC5uYW1lIF0gPSAkLmV4dGVuZCggc2V0dGluZ3MubWVzc2FnZXNbIGVsZW1lbnQubmFtZSBdLCBhcmd1bWVudC5tZXNzYWdlcyApOw0KCQkJCX0NCgkJCQlicmVhazsNCgkJCWNhc2UgInJlbW92ZSI6DQoJCQkJaWYgKCAhYXJndW1lbnQgKSB7DQoJCQkJCWRlbGV0ZSBzdGF0aWNSdWxlc1sgZWxlbWVudC5uYW1lIF07DQoJCQkJCXJldHVybiBleGlzdGluZ1J1bGVzOw0KCQkJCX0NCgkJCQlmaWx0ZXJlZCA9IHt9Ow0KCQkJCSQuZWFjaCggYXJndW1lbnQuc3BsaXQoIC9ccy8gKSwgZnVuY3Rpb24oIGluZGV4LCBtZXRob2QgKSB7DQoJCQkJCWZpbHRlcmVkWyBtZXRob2QgXSA9IGV4aXN0aW5nUnVsZXNbIG1ldGhvZCBdOw0KCQkJCQlkZWxldGUgZXhpc3RpbmdSdWxlc1sgbWV0aG9kIF07DQoJCQkJfSApOw0KCQkJCXJldHVybiBmaWx0ZXJlZDsNCgkJCX0NCgkJfQ0KDQoJCWRhdGEgPSAkLnZhbGlkYXRvci5ub3JtYWxpemVSdWxlcygNCgkJJC5leHRlbmQoDQoJCQl7fSwNCgkJCSQudmFsaWRhdG9yLmNsYXNzUnVsZXMoIGVsZW1lbnQgKSwNCgkJCSQudmFsaWRhdG9yLmF0dHJpYnV0ZVJ1bGVzKCBlbGVtZW50ICksDQoJCQkkLnZhbGlkYXRvci5kYXRhUnVsZXMoIGVsZW1lbnQgKSwNCgkJCSQudmFsaWRhdG9yLnN0YXRpY1J1bGVzKCBlbGVtZW50ICkNCgkJKSwgZWxlbWVudCApOw0KDQoJCS8vIE1ha2Ugc3VyZSByZXF1aXJlZCBpcyBhdCBmcm9udA0KCQlpZiAoIGRhdGEucmVxdWlyZWQgKSB7DQoJCQlwYXJhbSA9IGRhdGEucmVxdWlyZWQ7DQoJCQlkZWxldGUgZGF0YS5yZXF1aXJlZDsNCgkJCWRhdGEgPSAkLmV4dGVuZCggeyByZXF1aXJlZDogcGFyYW0gfSwgZGF0YSApOw0KCQl9DQoNCgkJLy8gTWFrZSBzdXJlIHJlbW90ZSBpcyBhdCBiYWNrDQoJCWlmICggZGF0YS5yZW1vdGUgKSB7DQoJCQlwYXJhbSA9IGRhdGEucmVtb3RlOw0KCQkJZGVsZXRlIGRhdGEucmVtb3RlOw0KCQkJZGF0YSA9ICQuZXh0ZW5kKCBkYXRhLCB7IHJlbW90ZTogcGFyYW0gfSApOw0KCQl9DQoNCgkJcmV0dXJuIGRhdGE7DQoJfQ0KfSApOw0KDQovLyBDdXN0b20gc2VsZWN0b3JzDQokLmV4dGVuZCggJC5leHByLnBzZXVkb3MgfHwgJC5leHByWyAiOiIgXSwgewkJLy8gJ3x8ICQuZXhwclsgIjoiIF0nIGhlcmUgZW5hYmxlcyBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSB0byBqUXVlcnkgMS43LiBDYW4gYmUgcmVtb3ZlZCB3aGVuIGRyb3BwaW5nIGpRIDEuNy54IHN1cHBvcnQNCg0KCS8vIGh0dHBzOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvYmxhbmstc2VsZWN0b3IvDQoJYmxhbms6IGZ1bmN0aW9uKCBhICkgew0KCQlyZXR1cm4gISQudHJpbSggIiIgKyAkKCBhICkudmFsKCkgKTsNCgl9LA0KDQoJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9maWxsZWQtc2VsZWN0b3IvDQoJZmlsbGVkOiBmdW5jdGlvbiggYSApIHsNCgkJdmFyIHZhbCA9ICQoIGEgKS52YWwoKTsNCgkJcmV0dXJuIHZhbCAhPT0gbnVsbCAmJiAhISQudHJpbSggIiIgKyB2YWwgKTsNCgl9LA0KDQoJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy91bmNoZWNrZWQtc2VsZWN0b3IvDQoJdW5jaGVja2VkOiBmdW5jdGlvbiggYSApIHsNCgkJcmV0dXJuICEkKCBhICkucHJvcCggImNoZWNrZWQiICk7DQoJfQ0KfSApOw0KDQovLyBDb25zdHJ1Y3RvciBmb3IgdmFsaWRhdG9yDQokLnZhbGlkYXRvciA9IGZ1bmN0aW9uKCBvcHRpb25zLCBmb3JtICkgew0KCXRoaXMuc2V0dGluZ3MgPSAkLmV4dGVuZCggdHJ1ZSwge30sICQudmFsaWRhdG9yLmRlZmF1bHRzLCBvcHRpb25zICk7DQoJdGhpcy5jdXJyZW50Rm9ybSA9IGZvcm07DQoJdGhpcy5pbml0KCk7DQp9Ow0KDQovLyBodHRwczovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2pRdWVyeS52YWxpZGF0b3IuZm9ybWF0Lw0KJC52YWxpZGF0b3IuZm9ybWF0ID0gZnVuY3Rpb24oIHNvdXJjZSwgcGFyYW1zICkgew0KCWlmICggYXJndW1lbnRzLmxlbmd0aCA9PT0gMSApIHsNCgkJcmV0dXJuIGZ1bmN0aW9uKCkgew0KCQkJdmFyIGFyZ3MgPSAkLm1ha2VBcnJheSggYXJndW1lbnRzICk7DQoJCQlhcmdzLnVuc2hpZnQoIHNvdXJjZSApOw0KCQkJcmV0dXJuICQudmFsaWRhdG9yLmZvcm1hdC5hcHBseSggdGhpcywgYXJncyApOw0KCQl9Ow0KCX0NCglpZiAoIHBhcmFtcyA9PT0gdW5kZWZpbmVkICkgew0KCQlyZXR1cm4gc291cmNlOw0KCX0NCglpZiAoIGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIHBhcmFtcy5jb25zdHJ1Y3RvciAhPT0gQXJyYXkgICkgew0KCQlwYXJhbXMgPSAkLm1ha2VBcnJheSggYXJndW1lbnRzICkuc2xpY2UoIDEgKTsNCgl9DQoJaWYgKCBwYXJhbXMuY29uc3RydWN0b3IgIT09IEFycmF5ICkgew0KCQlwYXJhbXMgPSBbIHBhcmFtcyBdOw0KCX0NCgkkLmVhY2goIHBhcmFtcywgZnVuY3Rpb24oIGksIG4gKSB7DQoJCXNvdXJjZSA9IHNvdXJjZS5yZXBsYWNlKCBuZXcgUmVnRXhwKCAiXFx7IiArIGkgKyAiXFx9IiwgImciICksIGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIG47DQoJCX0gKTsNCgl9ICk7DQoJcmV0dXJuIHNvdXJjZTsNCn07DQoNCiQuZXh0ZW5kKCAkLnZhbGlkYXRvciwgew0KDQoJZGVmYXVsdHM6IHsNCgkJbWVzc2FnZXM6IHt9LA0KCQlncm91cHM6IHt9LA0KCQlydWxlczoge30sDQoJCWVycm9yQ2xhc3M6ICJlcnJvciIsDQoJCXBlbmRpbmdDbGFzczogInBlbmRpbmciLA0KCQl2YWxpZENsYXNzOiAidmFsaWQiLA0KCQllcnJvckVsZW1lbnQ6ICJsYWJlbCIsDQoJCWZvY3VzQ2xlYW51cDogZmFsc2UsDQoJCWZvY3VzSW52YWxpZDogdHJ1ZSwNCgkJZXJyb3JDb250YWluZXI6ICQoIFtdICksDQoJCWVycm9yTGFiZWxDb250YWluZXI6ICQoIFtdICksDQoJCW9uc3VibWl0OiB0cnVlLA0KCQlpZ25vcmU6ICI6aGlkZGVuIiwNCgkJaWdub3JlVGl0bGU6IGZhbHNlLA0KCQlvbmZvY3VzaW46IGZ1bmN0aW9uKCBlbGVtZW50ICkgew0KCQkJdGhpcy5sYXN0QWN0aXZlID0gZWxlbWVudDsNCg0KCQkJLy8gSGlkZSBlcnJvciBsYWJlbCBhbmQgcmVtb3ZlIGVycm9yIGNsYXNzIG9uIGZvY3VzIGlmIGVuYWJsZWQNCgkJCWlmICggdGhpcy5zZXR0aW5ncy5mb2N1c0NsZWFudXAgKSB7DQoJCQkJaWYgKCB0aGlzLnNldHRpbmdzLnVuaGlnaGxpZ2h0ICkgew0KCQkJCQl0aGlzLnNldHRpbmdzLnVuaGlnaGxpZ2h0LmNhbGwoIHRoaXMsIGVsZW1lbnQsIHRoaXMuc2V0dGluZ3MuZXJyb3JDbGFzcywgdGhpcy5zZXR0aW5ncy52YWxpZENsYXNzICk7DQoJCQkJfQ0KCQkJCXRoaXMuaGlkZVRoZXNlKCB0aGlzLmVycm9yc0ZvciggZWxlbWVudCApICk7DQoJCQl9DQoJCX0sDQoJCW9uZm9jdXNvdXQ6IGZ1bmN0aW9uKCBlbGVtZW50ICkgew0KCQkJaWYgKCAhdGhpcy5jaGVja2FibGUoIGVsZW1lbnQgKSAmJiAoIGVsZW1lbnQubmFtZSBpbiB0aGlzLnN1Ym1pdHRlZCB8fCAhdGhpcy5vcHRpb25hbCggZWxlbWVudCApICkgKSB7DQoJCQkJdGhpcy5lbGVtZW50KCBlbGVtZW50ICk7DQoJCQl9DQoJCX0sDQoJCW9ua2V5dXA6IGZ1bmN0aW9uKCBlbGVtZW50LCBldmVudCApIHsNCg0KCQkJLy8gQXZvaWQgcmV2YWxpZGF0ZSB0aGUgZmllbGQgd2hlbiBwcmVzc2luZyBvbmUgb2YgdGhlIGZvbGxvd2luZyBrZXlzDQoJCQkvLyBTaGlmdCAgICAgICA9PiAxNg0KCQkJLy8gQ3RybCAgICAgICAgPT4gMTcNCgkJCS8vIEFsdCAgICAgICAgID0+IDE4DQoJCQkvLyBDYXBzIGxvY2sgICA9PiAyMA0KCQkJLy8gRW5kICAgICAgICAgPT4gMzUNCgkJCS8vIEhvbWUgICAgICAgID0+IDM2DQoJCQkvLyBMZWZ0IGFycm93ICA9PiAzNw0KCQkJLy8gVXAgYXJyb3cgICAgPT4gMzgNCgkJCS8vIFJpZ2h0IGFycm93ID0+IDM5DQoJCQkvLyBEb3duIGFycm93ICA9PiA0MA0KCQkJLy8gSW5zZXJ0ICAgICAgPT4gNDUNCgkJCS8vIE51bSBsb2NrICAgID0+IDE0NA0KCQkJLy8gQWx0R3Iga2V5ICAgPT4gMjI1DQoJCQl2YXIgZXhjbHVkZWRLZXlzID0gWw0KCQkJCTE2LCAxNywgMTgsIDIwLCAzNSwgMzYsIDM3LA0KCQkJCTM4LCAzOSwgNDAsIDQ1LCAxNDQsIDIyNQ0KCQkJXTsNCg0KCQkJaWYgKCBldmVudC53aGljaCA9PT0gOSAmJiB0aGlzLmVsZW1lbnRWYWx1ZSggZWxlbWVudCApID09PSAiIiB8fCAkLmluQXJyYXkoIGV2ZW50LmtleUNvZGUsIGV4Y2x1ZGVkS2V5cyApICE9PSAtMSApIHsNCgkJCQlyZXR1cm47DQoJCQl9IGVsc2UgaWYgKCBlbGVtZW50Lm5hbWUgaW4gdGhpcy5zdWJtaXR0ZWQgfHwgZWxlbWVudC5uYW1lIGluIHRoaXMuaW52YWxpZCApIHsNCgkJCQl0aGlzLmVsZW1lbnQoIGVsZW1lbnQgKTsNCgkJCX0NCgkJfSwNCgkJb25jbGljazogZnVuY3Rpb24oIGVsZW1lbnQgKSB7DQoNCgkJCS8vIENsaWNrIG9uIHNlbGVjdHMsIHJhZGlvYnV0dG9ucyBhbmQgY2hlY2tib3hlcw0KCQkJaWYgKCBlbGVtZW50Lm5hbWUgaW4gdGhpcy5zdWJtaXR0ZWQgKSB7DQoJCQkJdGhpcy5lbGVtZW50KCBlbGVtZW50ICk7DQoNCgkJCS8vIE9yIG9wdGlvbiBlbGVtZW50cywgY2hlY2sgcGFyZW50IHNlbGVjdCBpbiB0aGF0IGNhc2UNCgkJCX0gZWxzZSBpZiAoIGVsZW1lbnQucGFyZW50Tm9kZS5uYW1lIGluIHRoaXMuc3VibWl0dGVkICkgew0KCQkJCXRoaXMuZWxlbWVudCggZWxlbWVudC5wYXJlbnROb2RlICk7DQoJCQl9DQoJCX0sDQoJCWhpZ2hsaWdodDogZnVuY3Rpb24oIGVsZW1lbnQsIGVycm9yQ2xhc3MsIHZhbGlkQ2xhc3MgKSB7DQoJCQlpZiAoIGVsZW1lbnQudHlwZSA9PT0gInJhZGlvIiApIHsNCgkJCQl0aGlzLmZpbmRCeU5hbWUoIGVsZW1lbnQubmFtZSApLmFkZENsYXNzKCBlcnJvckNsYXNzICkucmVtb3ZlQ2xhc3MoIHZhbGlkQ2xhc3MgKTsNCgkJCX0gZWxzZSB7DQoJCQkJJCggZWxlbWVudCApLmFkZENsYXNzKCBlcnJvckNsYXNzICkucmVtb3ZlQ2xhc3MoIHZhbGlkQ2xhc3MgKTsNCgkJCX0NCgkJfSwNCgkJdW5oaWdobGlnaHQ6IGZ1bmN0aW9uKCBlbGVtZW50LCBlcnJvckNsYXNzLCB2YWxpZENsYXNzICkgew0KCQkJaWYgKCBlbGVtZW50LnR5cGUgPT09ICJyYWRpbyIgKSB7DQoJCQkJdGhpcy5maW5kQnlOYW1lKCBlbGVtZW50Lm5hbWUgKS5yZW1vdmVDbGFzcyggZXJyb3JDbGFzcyApLmFkZENsYXNzKCB2YWxpZENsYXNzICk7DQoJCQl9IGVsc2Ugew0KCQkJCSQoIGVsZW1lbnQgKS5yZW1vdmVDbGFzcyggZXJyb3JDbGFzcyApLmFkZENsYXNzKCB2YWxpZENsYXNzICk7DQoJCQl9DQoJCX0NCgl9LA0KDQoJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9qUXVlcnkudmFsaWRhdG9yLnNldERlZmF1bHRzLw0KCXNldERlZmF1bHRzOiBmdW5jdGlvbiggc2V0dGluZ3MgKSB7DQoJCSQuZXh0ZW5kKCAkLnZhbGlkYXRvci5kZWZhdWx0cywgc2V0dGluZ3MgKTsNCgl9LA0KDQoJbWVzc2FnZXM6IHsNCgkJcmVxdWlyZWQ6ICJUaGlzIGZpZWxkIGlzIHJlcXVpcmVkLiIsDQoJCXJlbW90ZTogIlBsZWFzZSBmaXggdGhpcyBmaWVsZC4iLA0KCQllbWFpbDogIlBsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsIGFkZHJlc3MuIiwNCgkJdXJsOiAiUGxlYXNlIGVudGVyIGEgdmFsaWQgVVJMLiIsDQoJCWRhdGU6ICJQbGVhc2UgZW50ZXIgYSB2YWxpZCBkYXRlLiIsDQoJCWRhdGVJU086ICJQbGVhc2UgZW50ZXIgYSB2YWxpZCBkYXRlIChJU08pLiIsDQoJCW51bWJlcjogIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iLA0KCQlkaWdpdHM6ICJQbGVhc2UgZW50ZXIgb25seSBkaWdpdHMuIiwNCgkJZXF1YWxUbzogIlBsZWFzZSBlbnRlciB0aGUgc2FtZSB2YWx1ZSBhZ2Fpbi4iLA0KCQltYXhsZW5ndGg6ICQudmFsaWRhdG9yLmZvcm1hdCggIlBsZWFzZSBlbnRlciBubyBtb3JlIHRoYW4gezB9IGNoYXJhY3RlcnMuIiApLA0KCQltaW5sZW5ndGg6ICQudmFsaWRhdG9yLmZvcm1hdCggIlBsZWFzZSBlbnRlciBhdCBsZWFzdCB7MH0gY2hhcmFjdGVycy4iICksDQoJCXJhbmdlbGVuZ3RoOiAkLnZhbGlkYXRvci5mb3JtYXQoICJQbGVhc2UgZW50ZXIgYSB2YWx1ZSBiZXR3ZWVuIHswfSBhbmQgezF9IGNoYXJhY3RlcnMgbG9uZy4iICksDQoJCXJhbmdlOiAkLnZhbGlkYXRvci5mb3JtYXQoICJQbGVhc2UgZW50ZXIgYSB2YWx1ZSBiZXR3ZWVuIHswfSBhbmQgezF9LiIgKSwNCgkJbWF4OiAkLnZhbGlkYXRvci5mb3JtYXQoICJQbGVhc2UgZW50ZXIgYSB2YWx1ZSBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gezB9LiIgKSwNCgkJbWluOiAkLnZhbGlkYXRvci5mb3JtYXQoICJQbGVhc2UgZW50ZXIgYSB2YWx1ZSBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gezB9LiIgKSwNCgkJc3RlcDogJC52YWxpZGF0b3IuZm9ybWF0KCAiUGxlYXNlIGVudGVyIGEgbXVsdGlwbGUgb2YgezB9LiIgKQ0KCX0sDQoNCglhdXRvQ3JlYXRlUmFuZ2VzOiBmYWxzZSwNCg0KCXByb3RvdHlwZTogew0KDQoJCWluaXQ6IGZ1bmN0aW9uKCkgew0KCQkJdGhpcy5sYWJlbENvbnRhaW5lciA9ICQoIHRoaXMuc2V0dGluZ3MuZXJyb3JMYWJlbENvbnRhaW5lciApOw0KCQkJdGhpcy5lcnJvckNvbnRleHQgPSB0aGlzLmxhYmVsQ29udGFpbmVyLmxlbmd0aCAmJiB0aGlzLmxhYmVsQ29udGFpbmVyIHx8ICQoIHRoaXMuY3VycmVudEZvcm0gKTsNCgkJCXRoaXMuY29udGFpbmVycyA9ICQoIHRoaXMuc2V0dGluZ3MuZXJyb3JDb250YWluZXIgKS5hZGQoIHRoaXMuc2V0dGluZ3MuZXJyb3JMYWJlbENvbnRhaW5lciApOw0KCQkJdGhpcy5zdWJtaXR0ZWQgPSB7fTsNCgkJCXRoaXMudmFsdWVDYWNoZSA9IHt9Ow0KCQkJdGhpcy5wZW5kaW5nUmVxdWVzdCA9IDA7DQoJCQl0aGlzLnBlbmRpbmcgPSB7fTsNCgkJCXRoaXMuaW52YWxpZCA9IHt9Ow0KCQkJdGhpcy5yZXNldCgpOw0KDQoJCQl2YXIgZ3JvdXBzID0gKCB0aGlzLmdyb3VwcyA9IHt9ICksDQoJCQkJcnVsZXM7DQoJCQkkLmVhY2goIHRoaXMuc2V0dGluZ3MuZ3JvdXBzLCBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsNCgkJCQlpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgKSB7DQoJCQkJCXZhbHVlID0gdmFsdWUuc3BsaXQoIC9ccy8gKTsNCgkJCQl9DQoJCQkJJC5lYWNoKCB2YWx1ZSwgZnVuY3Rpb24oIGluZGV4LCBuYW1lICkgew0KCQkJCQlncm91cHNbIG5hbWUgXSA9IGtleTsNCgkJCQl9ICk7DQoJCQl9ICk7DQoJCQlydWxlcyA9IHRoaXMuc2V0dGluZ3MucnVsZXM7DQoJCQkkLmVhY2goIHJ1bGVzLCBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsNCgkJCQlydWxlc1sga2V5IF0gPSAkLnZhbGlkYXRvci5ub3JtYWxpemVSdWxlKCB2YWx1ZSApOw0KCQkJfSApOw0KDQoJCQlmdW5jdGlvbiBkZWxlZ2F0ZSggZXZlbnQgKSB7DQoNCgkJCQkvLyBTZXQgZm9ybSBleHBhbmRvIG9uIGNvbnRlbnRlZGl0YWJsZQ0KCQkJCWlmICggIXRoaXMuZm9ybSAmJiB0aGlzLmhhc0F0dHJpYnV0ZSggImNvbnRlbnRlZGl0YWJsZSIgKSApIHsNCgkJCQkJdGhpcy5mb3JtID0gJCggdGhpcyApLmNsb3Nlc3QoICJmb3JtIiApWyAwIF07DQoJCQkJCXRoaXMubmFtZSA9ICQoIHRoaXMgKS5hdHRyKCAibmFtZSIgKTsNCgkJCQl9DQoNCgkJCQl2YXIgdmFsaWRhdG9yID0gJC5kYXRhKCB0aGlzLmZvcm0sICJ2YWxpZGF0b3IiICksDQoJCQkJCWV2ZW50VHlwZSA9ICJvbiIgKyBldmVudC50eXBlLnJlcGxhY2UoIC9edmFsaWRhdGUvLCAiIiApLA0KCQkJCQlzZXR0aW5ncyA9IHZhbGlkYXRvci5zZXR0aW5nczsNCgkJCQlpZiAoIHNldHRpbmdzWyBldmVudFR5cGUgXSAmJiAhJCggdGhpcyApLmlzKCBzZXR0aW5ncy5pZ25vcmUgKSApIHsNCgkJCQkJc2V0dGluZ3NbIGV2ZW50VHlwZSBdLmNhbGwoIHZhbGlkYXRvciwgdGhpcywgZXZlbnQgKTsNCgkJCQl9DQoJCQl9DQoNCgkJCSQoIHRoaXMuY3VycmVudEZvcm0gKQ0KCQkJCS5vbiggImZvY3VzaW4udmFsaWRhdGUgZm9jdXNvdXQudmFsaWRhdGUga2V5dXAudmFsaWRhdGUiLA0KCQkJCQkiOnRleHQsIFt0eXBlPSdwYXNzd29yZCddLCBbdHlwZT0nZmlsZSddLCBzZWxlY3QsIHRleHRhcmVhLCBbdHlwZT0nbnVtYmVyJ10sIFt0eXBlPSdzZWFyY2gnXSwgIiArDQoJCQkJCSJbdHlwZT0ndGVsJ10sIFt0eXBlPSd1cmwnXSwgW3R5cGU9J2VtYWlsJ10sIFt0eXBlPSdkYXRldGltZSddLCBbdHlwZT0nZGF0ZSddLCBbdHlwZT0nbW9udGgnXSwgIiArDQoJCQkJCSJbdHlwZT0nd2VlayddLCBbdHlwZT0ndGltZSddLCBbdHlwZT0nZGF0ZXRpbWUtbG9jYWwnXSwgW3R5cGU9J3JhbmdlJ10sIFt0eXBlPSdjb2xvciddLCAiICsNCgkJCQkJIlt0eXBlPSdyYWRpbyddLCBbdHlwZT0nY2hlY2tib3gnXSwgW2NvbnRlbnRlZGl0YWJsZV0sIFt0eXBlPSdidXR0b24nXSIsIGRlbGVnYXRlICkNCg0KCQkJCS8vIFN1cHBvcnQ6IENocm9tZSwgb2xkSUUNCgkJCQkvLyAic2VsZWN0IiBpcyBwcm92aWRlZCBhcyBldmVudC50YXJnZXQgd2hlbiBjbGlja2luZyBhIG9wdGlvbg0KCQkJCS5vbiggImNsaWNrLnZhbGlkYXRlIiwgInNlbGVjdCwgb3B0aW9uLCBbdHlwZT0ncmFkaW8nXSwgW3R5cGU9J2NoZWNrYm94J10iLCBkZWxlZ2F0ZSApOw0KDQoJCQlpZiAoIHRoaXMuc2V0dGluZ3MuaW52YWxpZEhhbmRsZXIgKSB7DQoJCQkJJCggdGhpcy5jdXJyZW50Rm9ybSApLm9uKCAiaW52YWxpZC1mb3JtLnZhbGlkYXRlIiwgdGhpcy5zZXR0aW5ncy5pbnZhbGlkSGFuZGxlciApOw0KCQkJfQ0KCQl9LA0KDQoJCS8vIGh0dHBzOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvVmFsaWRhdG9yLmZvcm0vDQoJCWZvcm06IGZ1bmN0aW9uKCkgew0KCQkJdGhpcy5jaGVja0Zvcm0oKTsNCgkJCSQuZXh0ZW5kKCB0aGlzLnN1Ym1pdHRlZCwgdGhpcy5lcnJvck1hcCApOw0KCQkJdGhpcy5pbnZhbGlkID0gJC5leHRlbmQoIHt9LCB0aGlzLmVycm9yTWFwICk7DQoJCQlpZiAoICF0aGlzLnZhbGlkKCkgKSB7DQoJCQkJJCggdGhpcy5jdXJyZW50Rm9ybSApLnRyaWdnZXJIYW5kbGVyKCAiaW52YWxpZC1mb3JtIiwgWyB0aGlzIF0gKTsNCgkJCX0NCgkJCXRoaXMuc2hvd0Vycm9ycygpOw0KCQkJcmV0dXJuIHRoaXMudmFsaWQoKTsNCgkJfSwNCg0KCQljaGVja0Zvcm06IGZ1bmN0aW9uKCkgew0KCQkJdGhpcy5wcmVwYXJlRm9ybSgpOw0KCQkJZm9yICggdmFyIGkgPSAwLCBlbGVtZW50cyA9ICggdGhpcy5jdXJyZW50RWxlbWVudHMgPSB0aGlzLmVsZW1lbnRzKCkgKTsgZWxlbWVudHNbIGkgXTsgaSsrICkgew0KCQkJCXRoaXMuY2hlY2soIGVsZW1lbnRzWyBpIF0gKTsNCgkJCX0NCgkJCXJldHVybiB0aGlzLnZhbGlkKCk7DQoJCX0sDQoNCgkJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9WYWxpZGF0b3IuZWxlbWVudC8NCgkJZWxlbWVudDogZnVuY3Rpb24oIGVsZW1lbnQgKSB7DQoJCQl2YXIgY2xlYW5FbGVtZW50ID0gdGhpcy5jbGVhbiggZWxlbWVudCApLA0KCQkJCWNoZWNrRWxlbWVudCA9IHRoaXMudmFsaWRhdGlvblRhcmdldEZvciggY2xlYW5FbGVtZW50ICksDQoJCQkJdiA9IHRoaXMsDQoJCQkJcmVzdWx0ID0gdHJ1ZSwNCgkJCQlycywgZ3JvdXA7DQoNCgkJCWlmICggY2hlY2tFbGVtZW50ID09PSB1bmRlZmluZWQgKSB7DQoJCQkJZGVsZXRlIHRoaXMuaW52YWxpZFsgY2xlYW5FbGVtZW50Lm5hbWUgXTsNCgkJCX0gZWxzZSB7DQoJCQkJdGhpcy5wcmVwYXJlRWxlbWVudCggY2hlY2tFbGVtZW50ICk7DQoJCQkJdGhpcy5jdXJyZW50RWxlbWVudHMgPSAkKCBjaGVja0VsZW1lbnQgKTsNCg0KCQkJCS8vIElmIHRoaXMgZWxlbWVudCBpcyBncm91cGVkLCB0aGVuIHZhbGlkYXRlIGFsbCBncm91cCBlbGVtZW50cyBhbHJlYWR5DQoJCQkJLy8gY29udGFpbmluZyBhIHZhbHVlDQoJCQkJZ3JvdXAgPSB0aGlzLmdyb3Vwc1sgY2hlY2tFbGVtZW50Lm5hbWUgXTsNCgkJCQlpZiAoIGdyb3VwICkgew0KCQkJCQkkLmVhY2goIHRoaXMuZ3JvdXBzLCBmdW5jdGlvbiggbmFtZSwgdGVzdGdyb3VwICkgew0KCQkJCQkJaWYgKCB0ZXN0Z3JvdXAgPT09IGdyb3VwICYmIG5hbWUgIT09IGNoZWNrRWxlbWVudC5uYW1lICkgew0KCQkJCQkJCWNsZWFuRWxlbWVudCA9IHYudmFsaWRhdGlvblRhcmdldEZvciggdi5jbGVhbiggdi5maW5kQnlOYW1lKCBuYW1lICkgKSApOw0KCQkJCQkJCWlmICggY2xlYW5FbGVtZW50ICYmIGNsZWFuRWxlbWVudC5uYW1lIGluIHYuaW52YWxpZCApIHsNCgkJCQkJCQkJdi5jdXJyZW50RWxlbWVudHMucHVzaCggY2xlYW5FbGVtZW50ICk7DQoJCQkJCQkJCXJlc3VsdCA9IHYuY2hlY2soIGNsZWFuRWxlbWVudCApICYmIHJlc3VsdDsNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCX0gKTsNCgkJCQl9DQoNCgkJCQlycyA9IHRoaXMuY2hlY2soIGNoZWNrRWxlbWVudCApICE9PSBmYWxzZTsNCgkJCQlyZXN1bHQgPSByZXN1bHQgJiYgcnM7DQoJCQkJaWYgKCBycyApIHsNCgkJCQkJdGhpcy5pbnZhbGlkWyBjaGVja0VsZW1lbnQubmFtZSBdID0gZmFsc2U7DQoJCQkJfSBlbHNlIHsNCgkJCQkJdGhpcy5pbnZhbGlkWyBjaGVja0VsZW1lbnQubmFtZSBdID0gdHJ1ZTsNCgkJCQl9DQoNCgkJCQlpZiAoICF0aGlzLm51bWJlck9mSW52YWxpZHMoKSApIHsNCg0KCQkJCQkvLyBIaWRlIGVycm9yIGNvbnRhaW5lcnMgb24gbGFzdCBlcnJvcg0KCQkJCQl0aGlzLnRvSGlkZSA9IHRoaXMudG9IaWRlLmFkZCggdGhpcy5jb250YWluZXJzICk7DQoJCQkJfQ0KCQkJCXRoaXMuc2hvd0Vycm9ycygpOw0KDQoJCQkJLy8gQWRkIGFyaWEtaW52YWxpZCBzdGF0dXMgZm9yIHNjcmVlbiByZWFkZXJzDQoJCQkJJCggZWxlbWVudCApLmF0dHIoICJhcmlhLWludmFsaWQiLCAhcnMgKTsNCgkJCX0NCg0KCQkJcmV0dXJuIHJlc3VsdDsNCgkJfSwNCg0KCQkvLyBodHRwczovL2pxdWVyeXZhbGlkYXRpb24ub3JnL1ZhbGlkYXRvci5zaG93RXJyb3JzLw0KCQlzaG93RXJyb3JzOiBmdW5jdGlvbiggZXJyb3JzICkgew0KCQkJaWYgKCBlcnJvcnMgKSB7DQoJCQkJdmFyIHZhbGlkYXRvciA9IHRoaXM7DQoNCgkJCQkvLyBBZGQgaXRlbXMgdG8gZXJyb3IgbGlzdCBhbmQgbWFwDQoJCQkJJC5leHRlbmQoIHRoaXMuZXJyb3JNYXAsIGVycm9ycyApOw0KCQkJCXRoaXMuZXJyb3JMaXN0ID0gJC5tYXAoIHRoaXMuZXJyb3JNYXAsIGZ1bmN0aW9uKCBtZXNzYWdlLCBuYW1lICkgew0KCQkJCQlyZXR1cm4gew0KCQkJCQkJbWVzc2FnZTogbWVzc2FnZSwNCgkJCQkJCWVsZW1lbnQ6IHZhbGlkYXRvci5maW5kQnlOYW1lKCBuYW1lIClbIDAgXQ0KCQkJCQl9Ow0KCQkJCX0gKTsNCg0KCQkJCS8vIFJlbW92ZSBpdGVtcyBmcm9tIHN1Y2Nlc3MgbGlzdA0KCQkJCXRoaXMuc3VjY2Vzc0xpc3QgPSAkLmdyZXAoIHRoaXMuc3VjY2Vzc0xpc3QsIGZ1bmN0aW9uKCBlbGVtZW50ICkgew0KCQkJCQlyZXR1cm4gISggZWxlbWVudC5uYW1lIGluIGVycm9ycyApOw0KCQkJCX0gKTsNCgkJCX0NCgkJCWlmICggdGhpcy5zZXR0aW5ncy5zaG93RXJyb3JzICkgew0KCQkJCXRoaXMuc2V0dGluZ3Muc2hvd0Vycm9ycy5jYWxsKCB0aGlzLCB0aGlzLmVycm9yTWFwLCB0aGlzLmVycm9yTGlzdCApOw0KCQkJfSBlbHNlIHsNCgkJCQl0aGlzLmRlZmF1bHRTaG93RXJyb3JzKCk7DQoJCQl9DQoJCX0sDQoNCgkJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9WYWxpZGF0b3IucmVzZXRGb3JtLw0KCQlyZXNldEZvcm06IGZ1bmN0aW9uKCkgew0KCQkJaWYgKCAkLmZuLnJlc2V0Rm9ybSApIHsNCgkJCQkkKCB0aGlzLmN1cnJlbnRGb3JtICkucmVzZXRGb3JtKCk7DQoJCQl9DQoJCQl0aGlzLmludmFsaWQgPSB7fTsNCgkJCXRoaXMuc3VibWl0dGVkID0ge307DQoJCQl0aGlzLnByZXBhcmVGb3JtKCk7DQoJCQl0aGlzLmhpZGVFcnJvcnMoKTsNCgkJCXZhciBlbGVtZW50cyA9IHRoaXMuZWxlbWVudHMoKQ0KCQkJCS5yZW1vdmVEYXRhKCAicHJldmlvdXNWYWx1ZSIgKQ0KCQkJCS5yZW1vdmVBdHRyKCAiYXJpYS1pbnZhbGlkIiApOw0KDQoJCQl0aGlzLnJlc2V0RWxlbWVudHMoIGVsZW1lbnRzICk7DQoJCX0sDQoNCgkJcmVzZXRFbGVtZW50czogZnVuY3Rpb24oIGVsZW1lbnRzICkgew0KCQkJdmFyIGk7DQoNCgkJCWlmICggdGhpcy5zZXR0aW5ncy51bmhpZ2hsaWdodCApIHsNCgkJCQlmb3IgKCBpID0gMDsgZWxlbWVudHNbIGkgXTsgaSsrICkgew0KCQkJCQl0aGlzLnNldHRpbmdzLnVuaGlnaGxpZ2h0LmNhbGwoIHRoaXMsIGVsZW1lbnRzWyBpIF0sDQoJCQkJCQl0aGlzLnNldHRpbmdzLmVycm9yQ2xhc3MsICIiICk7DQoJCQkJCXRoaXMuZmluZEJ5TmFtZSggZWxlbWVudHNbIGkgXS5uYW1lICkucmVtb3ZlQ2xhc3MoIHRoaXMuc2V0dGluZ3MudmFsaWRDbGFzcyApOw0KCQkJCX0NCgkJCX0gZWxzZSB7DQoJCQkJZWxlbWVudHMNCgkJCQkJLnJlbW92ZUNsYXNzKCB0aGlzLnNldHRpbmdzLmVycm9yQ2xhc3MgKQ0KCQkJCQkucmVtb3ZlQ2xhc3MoIHRoaXMuc2V0dGluZ3MudmFsaWRDbGFzcyApOw0KCQkJfQ0KCQl9LA0KDQoJCW51bWJlck9mSW52YWxpZHM6IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIHRoaXMub2JqZWN0TGVuZ3RoKCB0aGlzLmludmFsaWQgKTsNCgkJfSwNCg0KCQlvYmplY3RMZW5ndGg6IGZ1bmN0aW9uKCBvYmogKSB7DQoJCQkvKiBqc2hpbnQgdW51c2VkOiBmYWxzZSAqLw0KCQkJdmFyIGNvdW50ID0gMCwNCgkJCQlpOw0KCQkJZm9yICggaSBpbiBvYmogKSB7DQoNCgkJCQkvLyBUaGlzIGNoZWNrIGFsbG93cyBjb3VudGluZyBlbGVtZW50cyB3aXRoIGVtcHR5IGVycm9yDQoJCQkJLy8gbWVzc2FnZSBhcyBpbnZhbGlkIGVsZW1lbnRzDQoJCQkJaWYgKCBvYmpbIGkgXSAhPT0gdW5kZWZpbmVkICYmIG9ialsgaSBdICE9PSBudWxsICYmIG9ialsgaSBdICE9PSBmYWxzZSApIHsNCgkJCQkJY291bnQrKzsNCgkJCQl9DQoJCQl9DQoJCQlyZXR1cm4gY291bnQ7DQoJCX0sDQoNCgkJaGlkZUVycm9yczogZnVuY3Rpb24oKSB7DQoJCQl0aGlzLmhpZGVUaGVzZSggdGhpcy50b0hpZGUgKTsNCgkJfSwNCg0KCQloaWRlVGhlc2U6IGZ1bmN0aW9uKCBlcnJvcnMgKSB7DQoJCQllcnJvcnMubm90KCB0aGlzLmNvbnRhaW5lcnMgKS50ZXh0KCAiIiApOw0KCQkJdGhpcy5hZGRXcmFwcGVyKCBlcnJvcnMgKS5oaWRlKCk7DQoJCX0sDQoNCgkJdmFsaWQ6IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIHRoaXMuc2l6ZSgpID09PSAwOw0KCQl9LA0KDQoJCXNpemU6IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIHRoaXMuZXJyb3JMaXN0Lmxlbmd0aDsNCgkJfSwNCg0KCQlmb2N1c0ludmFsaWQ6IGZ1bmN0aW9uKCkgew0KCQkJaWYgKCB0aGlzLnNldHRpbmdzLmZvY3VzSW52YWxpZCApIHsNCgkJCQl0cnkgew0KCQkJCQkkKCB0aGlzLmZpbmRMYXN0QWN0aXZlKCkgfHwgdGhpcy5lcnJvckxpc3QubGVuZ3RoICYmIHRoaXMuZXJyb3JMaXN0WyAwIF0uZWxlbWVudCB8fCBbXSApDQoJCQkJCS5maWx0ZXIoICI6dmlzaWJsZSIgKQ0KCQkJCQkuZm9jdXMoKQ0KDQoJCQkJCS8vIE1hbnVhbGx5IHRyaWdnZXIgZm9jdXNpbiBldmVudDsgd2l0aG91dCBpdCwgZm9jdXNpbiBoYW5kbGVyIGlzbid0IGNhbGxlZCwgZmluZExhc3RBY3RpdmUgd29uJ3QgaGF2ZSBhbnl0aGluZyB0byBmaW5kDQoJCQkJCS50cmlnZ2VyKCAiZm9jdXNpbiIgKTsNCgkJCQl9IGNhdGNoICggZSApIHsNCg0KCQkJCQkvLyBJZ25vcmUgSUUgdGhyb3dpbmcgZXJyb3JzIHdoZW4gZm9jdXNpbmcgaGlkZGVuIGVsZW1lbnRzDQoJCQkJfQ0KCQkJfQ0KCQl9LA0KDQoJCWZpbmRMYXN0QWN0aXZlOiBmdW5jdGlvbigpIHsNCgkJCXZhciBsYXN0QWN0aXZlID0gdGhpcy5sYXN0QWN0aXZlOw0KCQkJcmV0dXJuIGxhc3RBY3RpdmUgJiYgJC5ncmVwKCB0aGlzLmVycm9yTGlzdCwgZnVuY3Rpb24oIG4gKSB7DQoJCQkJcmV0dXJuIG4uZWxlbWVudC5uYW1lID09PSBsYXN0QWN0aXZlLm5hbWU7DQoJCQl9ICkubGVuZ3RoID09PSAxICYmIGxhc3RBY3RpdmU7DQoJCX0sDQoNCgkJZWxlbWVudHM6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIHZhbGlkYXRvciA9IHRoaXMsDQoJCQkJcnVsZXNDYWNoZSA9IHt9Ow0KDQoJCQkvLyBTZWxlY3QgYWxsIHZhbGlkIGlucHV0cyBpbnNpZGUgdGhlIGZvcm0gKG5vIHN1Ym1pdCBvciByZXNldCBidXR0b25zKQ0KCQkJcmV0dXJuICQoIHRoaXMuY3VycmVudEZvcm0gKQ0KCQkJLmZpbmQoICJpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYSwgW2NvbnRlbnRlZGl0YWJsZV0iICkNCgkJCS5ub3QoICI6c3VibWl0LCA6cmVzZXQsIDppbWFnZSwgOmRpc2FibGVkIiApDQoJCQkubm90KCB0aGlzLnNldHRpbmdzLmlnbm9yZSApDQoJCQkuZmlsdGVyKCBmdW5jdGlvbigpIHsNCgkJCQl2YXIgbmFtZSA9IHRoaXMubmFtZSB8fCAkKCB0aGlzICkuYXR0ciggIm5hbWUiICk7IC8vIEZvciBjb250ZW50ZWRpdGFibGUNCgkJCQlpZiAoICFuYW1lICYmIHZhbGlkYXRvci5zZXR0aW5ncy5kZWJ1ZyAmJiB3aW5kb3cuY29uc29sZSApIHsNCgkJCQkJY29uc29sZS5lcnJvciggIiVvIGhhcyBubyBuYW1lIGFzc2lnbmVkIiwgdGhpcyApOw0KCQkJCX0NCg0KCQkJCS8vIFNldCBmb3JtIGV4cGFuZG8gb24gY29udGVudGVkaXRhYmxlDQoJCQkJaWYgKCB0aGlzLmhhc0F0dHJpYnV0ZSggImNvbnRlbnRlZGl0YWJsZSIgKSApIHsNCgkJCQkJdGhpcy5mb3JtID0gJCggdGhpcyApLmNsb3Nlc3QoICJmb3JtIiApWyAwIF07DQoJCQkJCXRoaXMubmFtZSA9IG5hbWU7DQoJCQkJfQ0KDQoJCQkJLy8gU2VsZWN0IG9ubHkgdGhlIGZpcnN0IGVsZW1lbnQgZm9yIGVhY2ggbmFtZSwgYW5kIG9ubHkgdGhvc2Ugd2l0aCBydWxlcyBzcGVjaWZpZWQNCgkJCQlpZiAoIG5hbWUgaW4gcnVsZXNDYWNoZSB8fCAhdmFsaWRhdG9yLm9iamVjdExlbmd0aCggJCggdGhpcyApLnJ1bGVzKCkgKSApIHsNCgkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCX0NCg0KCQkJCXJ1bGVzQ2FjaGVbIG5hbWUgXSA9IHRydWU7DQoJCQkJcmV0dXJuIHRydWU7DQoJCQl9ICk7DQoJCX0sDQoNCgkJY2xlYW46IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsNCgkJCXJldHVybiAkKCBzZWxlY3RvciApWyAwIF07DQoJCX0sDQoNCgkJZXJyb3JzOiBmdW5jdGlvbigpIHsNCgkJCXZhciBlcnJvckNsYXNzID0gdGhpcy5zZXR0aW5ncy5lcnJvckNsYXNzLnNwbGl0KCAiICIgKS5qb2luKCAiLiIgKTsNCgkJCXJldHVybiAkKCB0aGlzLnNldHRpbmdzLmVycm9yRWxlbWVudCArICIuIiArIGVycm9yQ2xhc3MsIHRoaXMuZXJyb3JDb250ZXh0ICk7DQoJCX0sDQoNCgkJcmVzZXRJbnRlcm5hbHM6IGZ1bmN0aW9uKCkgew0KCQkJdGhpcy5zdWNjZXNzTGlzdCA9IFtdOw0KCQkJdGhpcy5lcnJvckxpc3QgPSBbXTsNCgkJCXRoaXMuZXJyb3JNYXAgPSB7fTsNCgkJCXRoaXMudG9TaG93ID0gJCggW10gKTsNCgkJCXRoaXMudG9IaWRlID0gJCggW10gKTsNCgkJfSwNCg0KCQlyZXNldDogZnVuY3Rpb24oKSB7DQoJCQl0aGlzLnJlc2V0SW50ZXJuYWxzKCk7DQoJCQl0aGlzLmN1cnJlbnRFbGVtZW50cyA9ICQoIFtdICk7DQoJCX0sDQoNCgkJcHJlcGFyZUZvcm06IGZ1bmN0aW9uKCkgew0KCQkJdGhpcy5yZXNldCgpOw0KCQkJdGhpcy50b0hpZGUgPSB0aGlzLmVycm9ycygpLmFkZCggdGhpcy5jb250YWluZXJzICk7DQoJCX0sDQoNCgkJcHJlcGFyZUVsZW1lbnQ6IGZ1bmN0aW9uKCBlbGVtZW50ICkgew0KCQkJdGhpcy5yZXNldCgpOw0KCQkJdGhpcy50b0hpZGUgPSB0aGlzLmVycm9yc0ZvciggZWxlbWVudCApOw0KCQl9LA0KDQoJCWVsZW1lbnRWYWx1ZTogZnVuY3Rpb24oIGVsZW1lbnQgKSB7DQoJCQl2YXIgJGVsZW1lbnQgPSAkKCBlbGVtZW50ICksDQoJCQkJdHlwZSA9IGVsZW1lbnQudHlwZSwNCgkJCQl2YWwsIGlkeDsNCg0KCQkJaWYgKCB0eXBlID09PSAicmFkaW8iIHx8IHR5cGUgPT09ICJjaGVja2JveCIgKSB7DQoJCQkJcmV0dXJuIHRoaXMuZmluZEJ5TmFtZSggZWxlbWVudC5uYW1lICkuZmlsdGVyKCAiOmNoZWNrZWQiICkudmFsKCk7DQoJCQl9IGVsc2UgaWYgKCB0eXBlID09PSAibnVtYmVyIiAmJiB0eXBlb2YgZWxlbWVudC52YWxpZGl0eSAhPT0gInVuZGVmaW5lZCIgKSB7DQoJCQkJcmV0dXJuIGVsZW1lbnQudmFsaWRpdHkuYmFkSW5wdXQgPyAiTmFOIiA6ICRlbGVtZW50LnZhbCgpOw0KCQkJfQ0KDQoJCQlpZiAoIGVsZW1lbnQuaGFzQXR0cmlidXRlKCAiY29udGVudGVkaXRhYmxlIiApICkgew0KCQkJCXZhbCA9ICRlbGVtZW50LnRleHQoKTsNCgkJCX0gZWxzZSB7DQoJCQkJdmFsID0gJGVsZW1lbnQudmFsKCk7DQoJCQl9DQoNCgkJCWlmICggdHlwZSA9PT0gImZpbGUiICkgew0KDQoJCQkJLy8gTW9kZXJuIGJyb3dzZXIgKGNocm9tZSAmIHNhZmFyaSkNCgkJCQlpZiAoIHZhbC5zdWJzdHIoIDAsIDEyICkgPT09ICJDOlxcZmFrZXBhdGhcXCIgKSB7DQoJCQkJCXJldHVybiB2YWwuc3Vic3RyKCAxMiApOw0KCQkJCX0NCg0KCQkJCS8vIExlZ2FjeSBicm93c2Vycw0KCQkJCS8vIFVuaXgtYmFzZWQgcGF0aA0KCQkJCWlkeCA9IHZhbC5sYXN0SW5kZXhPZiggIi8iICk7DQoJCQkJaWYgKCBpZHggPj0gMCApIHsNCgkJCQkJcmV0dXJuIHZhbC5zdWJzdHIoIGlkeCArIDEgKTsNCgkJCQl9DQoNCgkJCQkvLyBXaW5kb3dzLWJhc2VkIHBhdGgNCgkJCQlpZHggPSB2YWwubGFzdEluZGV4T2YoICJcXCIgKTsNCgkJCQlpZiAoIGlkeCA+PSAwICkgew0KCQkJCQlyZXR1cm4gdmFsLnN1YnN0ciggaWR4ICsgMSApOw0KCQkJCX0NCg0KCQkJCS8vIEp1c3QgdGhlIGZpbGUgbmFtZQ0KCQkJCXJldHVybiB2YWw7DQoJCQl9DQoNCgkJCWlmICggdHlwZW9mIHZhbCA9PT0gInN0cmluZyIgKSB7DQoJCQkJcmV0dXJuIHZhbC5yZXBsYWNlKCAvXHIvZywgIiIgKTsNCgkJCX0NCgkJCXJldHVybiB2YWw7DQoJCX0sDQoNCgkJY2hlY2s6IGZ1bmN0aW9uKCBlbGVtZW50ICkgew0KCQkJZWxlbWVudCA9IHRoaXMudmFsaWRhdGlvblRhcmdldEZvciggdGhpcy5jbGVhbiggZWxlbWVudCApICk7DQoNCgkJCXZhciBydWxlcyA9ICQoIGVsZW1lbnQgKS5ydWxlcygpLA0KCQkJCXJ1bGVzQ291bnQgPSAkLm1hcCggcnVsZXMsIGZ1bmN0aW9uKCBuLCBpICkgew0KCQkJCQlyZXR1cm4gaTsNCgkJCQl9ICkubGVuZ3RoLA0KCQkJCWRlcGVuZGVuY3lNaXNtYXRjaCA9IGZhbHNlLA0KCQkJCXZhbCA9IHRoaXMuZWxlbWVudFZhbHVlKCBlbGVtZW50ICksDQoJCQkJcmVzdWx0LCBtZXRob2QsIHJ1bGUsIG5vcm1hbGl6ZXI7DQoNCgkJCS8vIFByaW9yaXRpemUgdGhlIGxvY2FsIG5vcm1hbGl6ZXIgZGVmaW5lZCBmb3IgdGhpcyBlbGVtZW50IG92ZXIgdGhlIGdsb2JhbCBvbmUNCgkJCS8vIGlmIHRoZSBmb3JtZXIgZXhpc3RzLCBvdGhlcndpc2UgdXNlciB0aGUgZ2xvYmFsIG9uZSBpbiBjYXNlIGl0IGV4aXN0cy4NCgkJCWlmICggdHlwZW9mIHJ1bGVzLm5vcm1hbGl6ZXIgPT09ICJmdW5jdGlvbiIgKSB7DQoJCQkJbm9ybWFsaXplciA9IHJ1bGVzLm5vcm1hbGl6ZXI7DQoJCQl9IGVsc2UgaWYgKAl0eXBlb2YgdGhpcy5zZXR0aW5ncy5ub3JtYWxpemVyID09PSAiZnVuY3Rpb24iICkgew0KCQkJCW5vcm1hbGl6ZXIgPSB0aGlzLnNldHRpbmdzLm5vcm1hbGl6ZXI7DQoJCQl9DQoNCgkJCS8vIElmIG5vcm1hbGl6ZXIgaXMgZGVmaW5lZCwgdGhlbiBjYWxsIGl0IHRvIHJldHJlaXZlIHRoZSBjaGFuZ2VkIHZhbHVlIGluc3RlYWQNCgkJCS8vIG9mIHVzaW5nIHRoZSByZWFsIG9uZS4NCgkJCS8vIE5vdGUgdGhhdCBgdGhpc2AgaW4gdGhlIG5vcm1hbGl6ZXIgaXMgYGVsZW1lbnRgLg0KCQkJaWYgKCBub3JtYWxpemVyICkgew0KCQkJCXZhbCA9IG5vcm1hbGl6ZXIuY2FsbCggZWxlbWVudCwgdmFsICk7DQoNCgkJCQlpZiAoIHR5cGVvZiB2YWwgIT09ICJzdHJpbmciICkgew0KCQkJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCAiVGhlIG5vcm1hbGl6ZXIgc2hvdWxkIHJldHVybiBhIHN0cmluZyB2YWx1ZS4iICk7DQoJCQkJfQ0KDQoJCQkJLy8gRGVsZXRlIHRoZSBub3JtYWxpemVyIGZyb20gcnVsZXMgdG8gYXZvaWQgdHJlYXRpbmcgaXQgYXMgYSBwcmUtZGVmaW5lZCBtZXRob2QuDQoJCQkJZGVsZXRlIHJ1bGVzLm5vcm1hbGl6ZXI7DQoJCQl9DQoNCgkJCWZvciAoIG1ldGhvZCBpbiBydWxlcyApIHsNCgkJCQlydWxlID0geyBtZXRob2Q6IG1ldGhvZCwgcGFyYW1ldGVyczogcnVsZXNbIG1ldGhvZCBdIH07DQoJCQkJdHJ5IHsNCgkJCQkJcmVzdWx0ID0gJC52YWxpZGF0b3IubWV0aG9kc1sgbWV0aG9kIF0uY2FsbCggdGhpcywgdmFsLCBlbGVtZW50LCBydWxlLnBhcmFtZXRlcnMgKTsNCg0KCQkJCQkvLyBJZiBhIG1ldGhvZCBpbmRpY2F0ZXMgdGhhdCB0aGUgZmllbGQgaXMgb3B0aW9uYWwgYW5kIHRoZXJlZm9yZSB2YWxpZCwNCgkJCQkJLy8gZG9uJ3QgbWFyayBpdCBhcyB2YWxpZCB3aGVuIHRoZXJlIGFyZSBubyBvdGhlciBydWxlcw0KCQkJCQlpZiAoIHJlc3VsdCA9PT0gImRlcGVuZGVuY3ktbWlzbWF0Y2giICYmIHJ1bGVzQ291bnQgPT09IDEgKSB7DQoJCQkJCQlkZXBlbmRlbmN5TWlzbWF0Y2ggPSB0cnVlOw0KCQkJCQkJY29udGludWU7DQoJCQkJCX0NCgkJCQkJZGVwZW5kZW5jeU1pc21hdGNoID0gZmFsc2U7DQoNCgkJCQkJaWYgKCByZXN1bHQgPT09ICJwZW5kaW5nIiApIHsNCgkJCQkJCXRoaXMudG9IaWRlID0gdGhpcy50b0hpZGUubm90KCB0aGlzLmVycm9yc0ZvciggZWxlbWVudCApICk7DQoJCQkJCQlyZXR1cm47DQoJCQkJCX0NCg0KCQkJCQlpZiAoICFyZXN1bHQgKSB7DQoJCQkJCQl0aGlzLmZvcm1hdEFuZEFkZCggZWxlbWVudCwgcnVsZSApOw0KCQkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCQl9DQoJCQkJfSBjYXRjaCAoIGUgKSB7DQoJCQkJCWlmICggdGhpcy5zZXR0aW5ncy5kZWJ1ZyAmJiB3aW5kb3cuY29uc29sZSApIHsNCgkJCQkJCWNvbnNvbGUubG9nKCAiRXhjZXB0aW9uIG9jY3VycmVkIHdoZW4gY2hlY2tpbmcgZWxlbWVudCAiICsgZWxlbWVudC5pZCArICIsIGNoZWNrIHRoZSAnIiArIHJ1bGUubWV0aG9kICsgIicgbWV0aG9kLiIsIGUgKTsNCgkJCQkJfQ0KCQkJCQlpZiAoIGUgaW5zdGFuY2VvZiBUeXBlRXJyb3IgKSB7DQoJCQkJCQllLm1lc3NhZ2UgKz0gIi4gIEV4Y2VwdGlvbiBvY2N1cnJlZCB3aGVuIGNoZWNraW5nIGVsZW1lbnQgIiArIGVsZW1lbnQuaWQgKyAiLCBjaGVjayB0aGUgJyIgKyBydWxlLm1ldGhvZCArICInIG1ldGhvZC4iOw0KCQkJCQl9DQoNCgkJCQkJdGhyb3cgZTsNCgkJCQl9DQoJCQl9DQoJCQlpZiAoIGRlcGVuZGVuY3lNaXNtYXRjaCApIHsNCgkJCQlyZXR1cm47DQoJCQl9DQoJCQlpZiAoIHRoaXMub2JqZWN0TGVuZ3RoKCBydWxlcyApICkgew0KCQkJCXRoaXMuc3VjY2Vzc0xpc3QucHVzaCggZWxlbWVudCApOw0KCQkJfQ0KCQkJcmV0dXJuIHRydWU7DQoJCX0sDQoNCgkJLy8gUmV0dXJuIHRoZSBjdXN0b20gbWVzc2FnZSBmb3IgdGhlIGdpdmVuIGVsZW1lbnQgYW5kIHZhbGlkYXRpb24gbWV0aG9kDQoJCS8vIHNwZWNpZmllZCBpbiB0aGUgZWxlbWVudCdzIEhUTUw1IGRhdGEgYXR0cmlidXRlDQoJCS8vIHJldHVybiB0aGUgZ2VuZXJpYyBtZXNzYWdlIGlmIHByZXNlbnQgYW5kIG5vIG1ldGhvZCBzcGVjaWZpYyBtZXNzYWdlIGlzIHByZXNlbnQNCgkJY3VzdG9tRGF0YU1lc3NhZ2U6IGZ1bmN0aW9uKCBlbGVtZW50LCBtZXRob2QgKSB7DQoJCQlyZXR1cm4gJCggZWxlbWVudCApLmRhdGEoICJtc2ciICsgbWV0aG9kLmNoYXJBdCggMCApLnRvVXBwZXJDYXNlKCkgKw0KCQkJCW1ldGhvZC5zdWJzdHJpbmcoIDEgKS50b0xvd2VyQ2FzZSgpICkgfHwgJCggZWxlbWVudCApLmRhdGEoICJtc2ciICk7DQoJCX0sDQoNCgkJLy8gUmV0dXJuIHRoZSBjdXN0b20gbWVzc2FnZSBmb3IgdGhlIGdpdmVuIGVsZW1lbnQgbmFtZSBhbmQgdmFsaWRhdGlvbiBtZXRob2QNCgkJY3VzdG9tTWVzc2FnZTogZnVuY3Rpb24oIG5hbWUsIG1ldGhvZCApIHsNCgkJCXZhciBtID0gdGhpcy5zZXR0aW5ncy5tZXNzYWdlc1sgbmFtZSBdOw0KCQkJcmV0dXJuIG0gJiYgKCBtLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgPyBtIDogbVsgbWV0aG9kIF0gKTsNCgkJfSwNCg0KCQkvLyBSZXR1cm4gdGhlIGZpcnN0IGRlZmluZWQgYXJndW1lbnQsIGFsbG93aW5nIGVtcHR5IHN0cmluZ3MNCgkJZmluZERlZmluZWQ6IGZ1bmN0aW9uKCkgew0KCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrICkgew0KCQkJCWlmICggYXJndW1lbnRzWyBpIF0gIT09IHVuZGVmaW5lZCApIHsNCgkJCQkJcmV0dXJuIGFyZ3VtZW50c1sgaSBdOw0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiB1bmRlZmluZWQ7DQoJCX0sDQoNCgkJLy8gVGhlIHNlY29uZCBwYXJhbWV0ZXIgJ3J1bGUnIHVzZWQgdG8gYmUgYSBzdHJpbmcsIGFuZCBleHRlbmRlZCB0byBhbiBvYmplY3QgbGl0ZXJhbA0KCQkvLyBvZiB0aGUgZm9sbG93aW5nIGZvcm06DQoJCS8vIHJ1bGUgPSB7DQoJCS8vICAgICBtZXRob2Q6ICJtZXRob2QgbmFtZSIsDQoJCS8vICAgICBwYXJhbWV0ZXJzOiAidGhlIGdpdmVuIG1ldGhvZCBwYXJhbWV0ZXJzIg0KCQkvLyB9DQoJCS8vDQoJCS8vIFRoZSBvbGQgYmVoYXZpb3Igc3RpbGwgc3VwcG9ydGVkLCBrZXB0IHRvIG1haW50YWluIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgd2l0aA0KCQkvLyBvbGQgY29kZSwgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiB0aGUgbmV4dCBtYWpvciByZWxlYXNlLg0KCQlkZWZhdWx0TWVzc2FnZTogZnVuY3Rpb24oIGVsZW1lbnQsIHJ1bGUgKSB7DQoJCQlpZiAoIHR5cGVvZiBydWxlID09PSAic3RyaW5nIiApIHsNCgkJCQlydWxlID0geyBtZXRob2Q6IHJ1bGUgfTsNCgkJCX0NCg0KCQkJdmFyIG1lc3NhZ2UgPSB0aGlzLmZpbmREZWZpbmVkKA0KCQkJCQl0aGlzLmN1c3RvbU1lc3NhZ2UoIGVsZW1lbnQubmFtZSwgcnVsZS5tZXRob2QgKSwNCgkJCQkJdGhpcy5jdXN0b21EYXRhTWVzc2FnZSggZWxlbWVudCwgcnVsZS5tZXRob2QgKSwNCg0KCQkJCQkvLyAndGl0bGUnIGlzIG5ldmVyIHVuZGVmaW5lZCwgc28gaGFuZGxlIGVtcHR5IHN0cmluZyBhcyB1bmRlZmluZWQNCgkJCQkJIXRoaXMuc2V0dGluZ3MuaWdub3JlVGl0bGUgJiYgZWxlbWVudC50aXRsZSB8fCB1bmRlZmluZWQsDQoJCQkJCSQudmFsaWRhdG9yLm1lc3NhZ2VzWyBydWxlLm1ldGhvZCBdLA0KCQkJCQkiPHN0cm9uZz5XYXJuaW5nOiBObyBtZXNzYWdlIGRlZmluZWQgZm9yICIgKyBlbGVtZW50Lm5hbWUgKyAiPC9zdHJvbmc+Ig0KCQkJCSksDQoJCQkJdGhlcmVnZXggPSAvXCQ/XHsoXGQrKVx9L2c7DQoJCQlpZiAoIHR5cGVvZiBtZXNzYWdlID09PSAiZnVuY3Rpb24iICkgew0KCQkJCW1lc3NhZ2UgPSBtZXNzYWdlLmNhbGwoIHRoaXMsIHJ1bGUucGFyYW1ldGVycywgZWxlbWVudCApOw0KCQkJfSBlbHNlIGlmICggdGhlcmVnZXgudGVzdCggbWVzc2FnZSApICkgew0KCQkJCW1lc3NhZ2UgPSAkLnZhbGlkYXRvci5mb3JtYXQoIG1lc3NhZ2UucmVwbGFjZSggdGhlcmVnZXgsICJ7JDF9IiApLCBydWxlLnBhcmFtZXRlcnMgKTsNCgkJCX0NCg0KCQkJcmV0dXJuIG1lc3NhZ2U7DQoJCX0sDQoNCgkJZm9ybWF0QW5kQWRkOiBmdW5jdGlvbiggZWxlbWVudCwgcnVsZSApIHsNCgkJCXZhciBtZXNzYWdlID0gdGhpcy5kZWZhdWx0TWVzc2FnZSggZWxlbWVudCwgcnVsZSApOw0KDQoJCQl0aGlzLmVycm9yTGlzdC5wdXNoKCB7DQoJCQkJbWVzc2FnZTogbWVzc2FnZSwNCgkJCQllbGVtZW50OiBlbGVtZW50LA0KCQkJCW1ldGhvZDogcnVsZS5tZXRob2QNCgkJCX0gKTsNCg0KCQkJdGhpcy5lcnJvck1hcFsgZWxlbWVudC5uYW1lIF0gPSBtZXNzYWdlOw0KCQkJdGhpcy5zdWJtaXR0ZWRbIGVsZW1lbnQubmFtZSBdID0gbWVzc2FnZTsNCgkJfSwNCg0KCQlhZGRXcmFwcGVyOiBmdW5jdGlvbiggdG9Ub2dnbGUgKSB7DQoJCQlpZiAoIHRoaXMuc2V0dGluZ3Mud3JhcHBlciApIHsNCgkJCQl0b1RvZ2dsZSA9IHRvVG9nZ2xlLmFkZCggdG9Ub2dnbGUucGFyZW50KCB0aGlzLnNldHRpbmdzLndyYXBwZXIgKSApOw0KCQkJfQ0KCQkJcmV0dXJuIHRvVG9nZ2xlOw0KCQl9LA0KDQoJCWRlZmF1bHRTaG93RXJyb3JzOiBmdW5jdGlvbigpIHsNCgkJCXZhciBpLCBlbGVtZW50cywgZXJyb3I7DQoJCQlmb3IgKCBpID0gMDsgdGhpcy5lcnJvckxpc3RbIGkgXTsgaSsrICkgew0KCQkJCWVycm9yID0gdGhpcy5lcnJvckxpc3RbIGkgXTsNCgkJCQlpZiAoIHRoaXMuc2V0dGluZ3MuaGlnaGxpZ2h0ICkgew0KCQkJCQl0aGlzLnNldHRpbmdzLmhpZ2hsaWdodC5jYWxsKCB0aGlzLCBlcnJvci5lbGVtZW50LCB0aGlzLnNldHRpbmdzLmVycm9yQ2xhc3MsIHRoaXMuc2V0dGluZ3MudmFsaWRDbGFzcyApOw0KCQkJCX0NCgkJCQl0aGlzLnNob3dMYWJlbCggZXJyb3IuZWxlbWVudCwgZXJyb3IubWVzc2FnZSApOw0KCQkJfQ0KCQkJaWYgKCB0aGlzLmVycm9yTGlzdC5sZW5ndGggKSB7DQoJCQkJdGhpcy50b1Nob3cgPSB0aGlzLnRvU2hvdy5hZGQoIHRoaXMuY29udGFpbmVycyApOw0KCQkJfQ0KCQkJaWYgKCB0aGlzLnNldHRpbmdzLnN1Y2Nlc3MgKSB7DQoJCQkJZm9yICggaSA9IDA7IHRoaXMuc3VjY2Vzc0xpc3RbIGkgXTsgaSsrICkgew0KCQkJCQl0aGlzLnNob3dMYWJlbCggdGhpcy5zdWNjZXNzTGlzdFsgaSBdICk7DQoJCQkJfQ0KCQkJfQ0KCQkJaWYgKCB0aGlzLnNldHRpbmdzLnVuaGlnaGxpZ2h0ICkgew0KCQkJCWZvciAoIGkgPSAwLCBlbGVtZW50cyA9IHRoaXMudmFsaWRFbGVtZW50cygpOyBlbGVtZW50c1sgaSBdOyBpKysgKSB7DQoJCQkJCXRoaXMuc2V0dGluZ3MudW5oaWdobGlnaHQuY2FsbCggdGhpcywgZWxlbWVudHNbIGkgXSwgdGhpcy5zZXR0aW5ncy5lcnJvckNsYXNzLCB0aGlzLnNldHRpbmdzLnZhbGlkQ2xhc3MgKTsNCgkJCQl9DQoJCQl9DQoJCQl0aGlzLnRvSGlkZSA9IHRoaXMudG9IaWRlLm5vdCggdGhpcy50b1Nob3cgKTsNCgkJCXRoaXMuaGlkZUVycm9ycygpOw0KCQkJdGhpcy5hZGRXcmFwcGVyKCB0aGlzLnRvU2hvdyApLnNob3coKTsNCgkJfSwNCg0KCQl2YWxpZEVsZW1lbnRzOiBmdW5jdGlvbigpIHsNCgkJCXJldHVybiB0aGlzLmN1cnJlbnRFbGVtZW50cy5ub3QoIHRoaXMuaW52YWxpZEVsZW1lbnRzKCkgKTsNCgkJfSwNCg0KCQlpbnZhbGlkRWxlbWVudHM6IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuICQoIHRoaXMuZXJyb3JMaXN0ICkubWFwKCBmdW5jdGlvbigpIHsNCgkJCQlyZXR1cm4gdGhpcy5lbGVtZW50Ow0KCQkJfSApOw0KCQl9LA0KDQoJCXNob3dMYWJlbDogZnVuY3Rpb24oIGVsZW1lbnQsIG1lc3NhZ2UgKSB7DQoJCQl2YXIgcGxhY2UsIGdyb3VwLCBlcnJvcklELCB2LA0KCQkJCWVycm9yID0gdGhpcy5lcnJvcnNGb3IoIGVsZW1lbnQgKSwNCgkJCQllbGVtZW50SUQgPSB0aGlzLmlkT3JOYW1lKCBlbGVtZW50ICksDQoJCQkJZGVzY3JpYmVkQnkgPSAkKCBlbGVtZW50ICkuYXR0ciggImFyaWEtZGVzY3JpYmVkYnkiICk7DQoNCgkJCWlmICggZXJyb3IubGVuZ3RoICkgew0KDQoJCQkJLy8gUmVmcmVzaCBlcnJvci9zdWNjZXNzIGNsYXNzDQoJCQkJZXJyb3IucmVtb3ZlQ2xhc3MoIHRoaXMuc2V0dGluZ3MudmFsaWRDbGFzcyApLmFkZENsYXNzKCB0aGlzLnNldHRpbmdzLmVycm9yQ2xhc3MgKTsNCg0KCQkJCS8vIFJlcGxhY2UgbWVzc2FnZSBvbiBleGlzdGluZyBsYWJlbA0KCQkJCWVycm9yLmh0bWwoIG1lc3NhZ2UgKTsNCgkJCX0gZWxzZSB7DQoNCgkJCQkvLyBDcmVhdGUgZXJyb3IgZWxlbWVudA0KCQkJCWVycm9yID0gJCggIjwiICsgdGhpcy5zZXR0aW5ncy5lcnJvckVsZW1lbnQgKyAiPiIgKQ0KCQkJCQkuYXR0ciggImlkIiwgZWxlbWVudElEICsgIi1lcnJvciIgKQ0KCQkJCQkuYWRkQ2xhc3MoIHRoaXMuc2V0dGluZ3MuZXJyb3JDbGFzcyApDQoJCQkJCS5odG1sKCBtZXNzYWdlIHx8ICIiICk7DQoNCgkJCQkvLyBNYWludGFpbiByZWZlcmVuY2UgdG8gdGhlIGVsZW1lbnQgdG8gYmUgcGxhY2VkIGludG8gdGhlIERPTQ0KCQkJCXBsYWNlID0gZXJyb3I7DQoJCQkJaWYgKCB0aGlzLnNldHRpbmdzLndyYXBwZXIgKSB7DQoNCgkJCQkJLy8gTWFrZSBzdXJlIHRoZSBlbGVtZW50IGlzIHZpc2libGUsIGV2ZW4gaW4gSUUNCgkJCQkJLy8gYWN0dWFsbHkgc2hvd2luZyB0aGUgd3JhcHBlZCBlbGVtZW50IGlzIGhhbmRsZWQgZWxzZXdoZXJlDQoJCQkJCXBsYWNlID0gZXJyb3IuaGlkZSgpLnNob3coKS53cmFwKCAiPCIgKyB0aGlzLnNldHRpbmdzLndyYXBwZXIgKyAiLz4iICkucGFyZW50KCk7DQoJCQkJfQ0KCQkJCWlmICggdGhpcy5sYWJlbENvbnRhaW5lci5sZW5ndGggKSB7DQoJCQkJCXRoaXMubGFiZWxDb250YWluZXIuYXBwZW5kKCBwbGFjZSApOw0KCQkJCX0gZWxzZSBpZiAoIHRoaXMuc2V0dGluZ3MuZXJyb3JQbGFjZW1lbnQgKSB7DQoJCQkJCXRoaXMuc2V0dGluZ3MuZXJyb3JQbGFjZW1lbnQuY2FsbCggdGhpcywgcGxhY2UsICQoIGVsZW1lbnQgKSApOw0KCQkJCX0gZWxzZSB7DQoJCQkJCXBsYWNlLmluc2VydEFmdGVyKCBlbGVtZW50ICk7DQoJCQkJfQ0KDQoJCQkJLy8gTGluayBlcnJvciBiYWNrIHRvIHRoZSBlbGVtZW50DQoJCQkJaWYgKCBlcnJvci5pcyggImxhYmVsIiApICkgew0KDQoJCQkJCS8vIElmIHRoZSBlcnJvciBpcyBhIGxhYmVsLCB0aGVuIGFzc29jaWF0ZSB1c2luZyAnZm9yJw0KCQkJCQllcnJvci5hdHRyKCAiZm9yIiwgZWxlbWVudElEICk7DQoNCgkJCQkJLy8gSWYgdGhlIGVsZW1lbnQgaXMgbm90IGEgY2hpbGQgb2YgYW4gYXNzb2NpYXRlZCBsYWJlbCwgdGhlbiBpdCdzIG5lY2Vzc2FyeQ0KCQkJCQkvLyB0byBleHBsaWNpdGx5IGFwcGx5IGFyaWEtZGVzY3JpYmVkYnkNCgkJCQl9IGVsc2UgaWYgKCBlcnJvci5wYXJlbnRzKCAibGFiZWxbZm9yPSciICsgdGhpcy5lc2NhcGVDc3NNZXRhKCBlbGVtZW50SUQgKSArICInXSIgKS5sZW5ndGggPT09IDAgKSB7DQoJCQkJCWVycm9ySUQgPSBlcnJvci5hdHRyKCAiaWQiICk7DQoNCgkJCQkJLy8gUmVzcGVjdCBleGlzdGluZyBub24tZXJyb3IgYXJpYS1kZXNjcmliZWRieQ0KCQkJCQlpZiAoICFkZXNjcmliZWRCeSApIHsNCgkJCQkJCWRlc2NyaWJlZEJ5ID0gZXJyb3JJRDsNCgkJCQkJfSBlbHNlIGlmICggIWRlc2NyaWJlZEJ5Lm1hdGNoKCBuZXcgUmVnRXhwKCAiXFxiIiArIHRoaXMuZXNjYXBlQ3NzTWV0YSggZXJyb3JJRCApICsgIlxcYiIgKSApICkgew0KDQoJCQkJCQkvLyBBZGQgdG8gZW5kIG9mIGxpc3QgaWYgbm90IGFscmVhZHkgcHJlc2VudA0KCQkJCQkJZGVzY3JpYmVkQnkgKz0gIiAiICsgZXJyb3JJRDsNCgkJCQkJfQ0KCQkJCQkkKCBlbGVtZW50ICkuYXR0ciggImFyaWEtZGVzY3JpYmVkYnkiLCBkZXNjcmliZWRCeSApOw0KDQoJCQkJCS8vIElmIHRoaXMgZWxlbWVudCBpcyBncm91cGVkLCB0aGVuIGFzc2lnbiB0byBhbGwgZWxlbWVudHMgaW4gdGhlIHNhbWUgZ3JvdXANCgkJCQkJZ3JvdXAgPSB0aGlzLmdyb3Vwc1sgZWxlbWVudC5uYW1lIF07DQoJCQkJCWlmICggZ3JvdXAgKSB7DQoJCQkJCQl2ID0gdGhpczsNCgkJCQkJCSQuZWFjaCggdi5ncm91cHMsIGZ1bmN0aW9uKCBuYW1lLCB0ZXN0Z3JvdXAgKSB7DQoJCQkJCQkJaWYgKCB0ZXN0Z3JvdXAgPT09IGdyb3VwICkgew0KCQkJCQkJCQkkKCAiW25hbWU9JyIgKyB2LmVzY2FwZUNzc01ldGEoIG5hbWUgKSArICInXSIsIHYuY3VycmVudEZvcm0gKQ0KCQkJCQkJCQkJLmF0dHIoICJhcmlhLWRlc2NyaWJlZGJ5IiwgZXJyb3IuYXR0ciggImlkIiApICk7DQoJCQkJCQkJfQ0KCQkJCQkJfSApOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQkJaWYgKCAhbWVzc2FnZSAmJiB0aGlzLnNldHRpbmdzLnN1Y2Nlc3MgKSB7DQoJCQkJZXJyb3IudGV4dCggIiIgKTsNCgkJCQlpZiAoIHR5cGVvZiB0aGlzLnNldHRpbmdzLnN1Y2Nlc3MgPT09ICJzdHJpbmciICkgew0KCQkJCQllcnJvci5hZGRDbGFzcyggdGhpcy5zZXR0aW5ncy5zdWNjZXNzICk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJdGhpcy5zZXR0aW5ncy5zdWNjZXNzKCBlcnJvciwgZWxlbWVudCApOw0KCQkJCX0NCgkJCX0NCgkJCXRoaXMudG9TaG93ID0gdGhpcy50b1Nob3cuYWRkKCBlcnJvciApOw0KCQl9LA0KDQoJCWVycm9yc0ZvcjogZnVuY3Rpb24oIGVsZW1lbnQgKSB7DQoJCQl2YXIgbmFtZSA9IHRoaXMuZXNjYXBlQ3NzTWV0YSggdGhpcy5pZE9yTmFtZSggZWxlbWVudCApICksDQoJCQkJZGVzY3JpYmVyID0gJCggZWxlbWVudCApLmF0dHIoICJhcmlhLWRlc2NyaWJlZGJ5IiApLA0KCQkJCXNlbGVjdG9yID0gImxhYmVsW2Zvcj0nIiArIG5hbWUgKyAiJ10sIGxhYmVsW2Zvcj0nIiArIG5hbWUgKyAiJ10gKiI7DQoNCgkJCS8vICdhcmlhLWRlc2NyaWJlZGJ5JyBzaG91bGQgZGlyZWN0bHkgcmVmZXJlbmNlIHRoZSBlcnJvciBlbGVtZW50DQoJCQlpZiAoIGRlc2NyaWJlciApIHsNCgkJCQlzZWxlY3RvciA9IHNlbGVjdG9yICsgIiwgIyIgKyB0aGlzLmVzY2FwZUNzc01ldGEoIGRlc2NyaWJlciApDQoJCQkJCS5yZXBsYWNlKCAvXHMrL2csICIsICMiICk7DQoJCQl9DQoNCgkJCXJldHVybiB0aGlzDQoJCQkJLmVycm9ycygpDQoJCQkJLmZpbHRlciggc2VsZWN0b3IgKTsNCgkJfSwNCg0KCQkvLyBTZWUgaHR0cHM6Ly9hcGkuanF1ZXJ5LmNvbS9jYXRlZ29yeS9zZWxlY3RvcnMvLCBmb3IgQ1NTDQoJCS8vIG1ldGEtY2hhcmFjdGVycyB0aGF0IHNob3VsZCBiZSBlc2NhcGVkIGluIG9yZGVyIHRvIGJlIHVzZWQgd2l0aCBKUXVlcnkNCgkJLy8gYXMgYSBsaXRlcmFsIHBhcnQgb2YgYSBuYW1lL2lkIG9yIGFueSBzZWxlY3Rvci4NCgkJZXNjYXBlQ3NzTWV0YTogZnVuY3Rpb24oIHN0cmluZyApIHsNCgkJCXJldHVybiBzdHJpbmcucmVwbGFjZSggLyhbXFwhIiMkJSYnKCkqKywuLzo7PD0+P0BcW1xdXmB7fH1+XSkvZywgIlxcJDEiICk7DQoJCX0sDQoNCgkJaWRPck5hbWU6IGZ1bmN0aW9uKCBlbGVtZW50ICkgew0KCQkJcmV0dXJuIHRoaXMuZ3JvdXBzWyBlbGVtZW50Lm5hbWUgXSB8fCAoIHRoaXMuY2hlY2thYmxlKCBlbGVtZW50ICkgPyBlbGVtZW50Lm5hbWUgOiBlbGVtZW50LmlkIHx8IGVsZW1lbnQubmFtZSApOw0KCQl9LA0KDQoJCXZhbGlkYXRpb25UYXJnZXRGb3I6IGZ1bmN0aW9uKCBlbGVtZW50ICkgew0KDQoJCQkvLyBJZiByYWRpby9jaGVja2JveCwgdmFsaWRhdGUgZmlyc3QgZWxlbWVudCBpbiBncm91cCBpbnN0ZWFkDQoJCQlpZiAoIHRoaXMuY2hlY2thYmxlKCBlbGVtZW50ICkgKSB7DQoJCQkJZWxlbWVudCA9IHRoaXMuZmluZEJ5TmFtZSggZWxlbWVudC5uYW1lICk7DQoJCQl9DQoNCgkJCS8vIEFsd2F5cyBhcHBseSBpZ25vcmUgZmlsdGVyDQoJCQlyZXR1cm4gJCggZWxlbWVudCApLm5vdCggdGhpcy5zZXR0aW5ncy5pZ25vcmUgKVsgMCBdOw0KCQl9LA0KDQoJCWNoZWNrYWJsZTogZnVuY3Rpb24oIGVsZW1lbnQgKSB7DQoJCQlyZXR1cm4gKCAvcmFkaW98Y2hlY2tib3gvaSApLnRlc3QoIGVsZW1lbnQudHlwZSApOw0KCQl9LA0KDQoJCWZpbmRCeU5hbWU6IGZ1bmN0aW9uKCBuYW1lICkgew0KCQkJcmV0dXJuICQoIHRoaXMuY3VycmVudEZvcm0gKS5maW5kKCAiW25hbWU9JyIgKyB0aGlzLmVzY2FwZUNzc01ldGEoIG5hbWUgKSArICInXSIgKTsNCgkJfSwNCg0KCQlnZXRMZW5ndGg6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCApIHsNCgkJCXN3aXRjaCAoIGVsZW1lbnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSApIHsNCgkJCWNhc2UgInNlbGVjdCI6DQoJCQkJcmV0dXJuICQoICJvcHRpb246c2VsZWN0ZWQiLCBlbGVtZW50ICkubGVuZ3RoOw0KCQkJY2FzZSAiaW5wdXQiOg0KCQkJCWlmICggdGhpcy5jaGVja2FibGUoIGVsZW1lbnQgKSApIHsNCgkJCQkJcmV0dXJuIHRoaXMuZmluZEJ5TmFtZSggZWxlbWVudC5uYW1lICkuZmlsdGVyKCAiOmNoZWNrZWQiICkubGVuZ3RoOw0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiB2YWx1ZS5sZW5ndGg7DQoJCX0sDQoNCgkJZGVwZW5kOiBmdW5jdGlvbiggcGFyYW0sIGVsZW1lbnQgKSB7DQoJCQlyZXR1cm4gdGhpcy5kZXBlbmRUeXBlc1sgdHlwZW9mIHBhcmFtIF0gPyB0aGlzLmRlcGVuZFR5cGVzWyB0eXBlb2YgcGFyYW0gXSggcGFyYW0sIGVsZW1lbnQgKSA6IHRydWU7DQoJCX0sDQoNCgkJZGVwZW5kVHlwZXM6IHsNCgkJCSJib29sZWFuIjogZnVuY3Rpb24oIHBhcmFtICkgew0KCQkJCXJldHVybiBwYXJhbTsNCgkJCX0sDQoJCQkic3RyaW5nIjogZnVuY3Rpb24oIHBhcmFtLCBlbGVtZW50ICkgew0KCQkJCXJldHVybiAhISQoIHBhcmFtLCBlbGVtZW50LmZvcm0gKS5sZW5ndGg7DQoJCQl9LA0KCQkJImZ1bmN0aW9uIjogZnVuY3Rpb24oIHBhcmFtLCBlbGVtZW50ICkgew0KCQkJCXJldHVybiBwYXJhbSggZWxlbWVudCApOw0KCQkJfQ0KCQl9LA0KDQoJCW9wdGlvbmFsOiBmdW5jdGlvbiggZWxlbWVudCApIHsNCgkJCXZhciB2YWwgPSB0aGlzLmVsZW1lbnRWYWx1ZSggZWxlbWVudCApOw0KCQkJcmV0dXJuICEkLnZhbGlkYXRvci5tZXRob2RzLnJlcXVpcmVkLmNhbGwoIHRoaXMsIHZhbCwgZWxlbWVudCApICYmICJkZXBlbmRlbmN5LW1pc21hdGNoIjsNCgkJfSwNCg0KCQlzdGFydFJlcXVlc3Q6IGZ1bmN0aW9uKCBlbGVtZW50ICkgew0KCQkJaWYgKCAhdGhpcy5wZW5kaW5nWyBlbGVtZW50Lm5hbWUgXSApIHsNCgkJCQl0aGlzLnBlbmRpbmdSZXF1ZXN0Kys7DQoJCQkJJCggZWxlbWVudCApLmFkZENsYXNzKCB0aGlzLnNldHRpbmdzLnBlbmRpbmdDbGFzcyApOw0KCQkJCXRoaXMucGVuZGluZ1sgZWxlbWVudC5uYW1lIF0gPSB0cnVlOw0KCQkJfQ0KCQl9LA0KDQoJCXN0b3BSZXF1ZXN0OiBmdW5jdGlvbiggZWxlbWVudCwgdmFsaWQgKSB7DQoJCQl0aGlzLnBlbmRpbmdSZXF1ZXN0LS07DQoNCgkJCS8vIFNvbWV0aW1lcyBzeW5jaHJvbml6YXRpb24gZmFpbHMsIG1ha2Ugc3VyZSBwZW5kaW5nUmVxdWVzdCBpcyBuZXZlciA8IDANCgkJCWlmICggdGhpcy5wZW5kaW5nUmVxdWVzdCA8IDAgKSB7DQoJCQkJdGhpcy5wZW5kaW5nUmVxdWVzdCA9IDA7DQoJCQl9DQoJCQlkZWxldGUgdGhpcy5wZW5kaW5nWyBlbGVtZW50Lm5hbWUgXTsNCgkJCSQoIGVsZW1lbnQgKS5yZW1vdmVDbGFzcyggdGhpcy5zZXR0aW5ncy5wZW5kaW5nQ2xhc3MgKTsNCgkJCWlmICggdmFsaWQgJiYgdGhpcy5wZW5kaW5nUmVxdWVzdCA9PT0gMCAmJiB0aGlzLmZvcm1TdWJtaXR0ZWQgJiYgdGhpcy5mb3JtKCkgKSB7DQoJCQkJJCggdGhpcy5jdXJyZW50Rm9ybSApLnN1Ym1pdCgpOw0KDQoJCQkJLy8gUmVtb3ZlIHRoZSBoaWRkZW4gaW5wdXQgdGhhdCB3YXMgdXNlZCBhcyBhIHJlcGxhY2VtZW50IGZvciB0aGUNCgkJCQkvLyBtaXNzaW5nIHN1Ym1pdCBidXR0b24uIFRoZSBoaWRkZW4gaW5wdXQgaXMgYWRkZWQgYnkgYGhhbmRsZSgpYA0KCQkJCS8vIHRvIGVuc3VyZSB0aGF0IHRoZSB2YWx1ZSBvZiB0aGUgdXNlZCBzdWJtaXQgYnV0dG9uIGlzIHBhc3NlZCBvbg0KCQkJCS8vIGZvciBzY3JpcHRlZCBzdWJtaXRzIHRyaWdnZXJlZCBieSB0aGlzIG1ldGhvZA0KCQkJCWlmICggdGhpcy5zdWJtaXRCdXR0b24gKSB7DQoJCQkJCSQoICJpbnB1dDpoaWRkZW5bbmFtZT0nIiArIHRoaXMuc3VibWl0QnV0dG9uLm5hbWUgKyAiJ10iLCB0aGlzLmN1cnJlbnRGb3JtICkucmVtb3ZlKCk7DQoJCQkJfQ0KDQoJCQkJdGhpcy5mb3JtU3VibWl0dGVkID0gZmFsc2U7DQoJCQl9IGVsc2UgaWYgKCAhdmFsaWQgJiYgdGhpcy5wZW5kaW5nUmVxdWVzdCA9PT0gMCAmJiB0aGlzLmZvcm1TdWJtaXR0ZWQgKSB7DQoJCQkJJCggdGhpcy5jdXJyZW50Rm9ybSApLnRyaWdnZXJIYW5kbGVyKCAiaW52YWxpZC1mb3JtIiwgWyB0aGlzIF0gKTsNCgkJCQl0aGlzLmZvcm1TdWJtaXR0ZWQgPSBmYWxzZTsNCgkJCX0NCgkJfSwNCg0KCQlwcmV2aW91c1ZhbHVlOiBmdW5jdGlvbiggZWxlbWVudCwgbWV0aG9kICkgew0KCQkJbWV0aG9kID0gdHlwZW9mIG1ldGhvZCA9PT0gInN0cmluZyIgJiYgbWV0aG9kIHx8ICJyZW1vdGUiOw0KDQoJCQlyZXR1cm4gJC5kYXRhKCBlbGVtZW50LCAicHJldmlvdXNWYWx1ZSIgKSB8fCAkLmRhdGEoIGVsZW1lbnQsICJwcmV2aW91c1ZhbHVlIiwgew0KCQkJCW9sZDogbnVsbCwNCgkJCQl2YWxpZDogdHJ1ZSwNCgkJCQltZXNzYWdlOiB0aGlzLmRlZmF1bHRNZXNzYWdlKCBlbGVtZW50LCB7IG1ldGhvZDogbWV0aG9kIH0gKQ0KCQkJfSApOw0KCQl9LA0KDQoJCS8vIENsZWFucyB1cCBhbGwgZm9ybXMgYW5kIGVsZW1lbnRzLCByZW1vdmVzIHZhbGlkYXRvci1zcGVjaWZpYyBldmVudHMNCgkJZGVzdHJveTogZnVuY3Rpb24oKSB7DQoJCQl0aGlzLnJlc2V0Rm9ybSgpOw0KDQoJCQkkKCB0aGlzLmN1cnJlbnRGb3JtICkNCgkJCQkub2ZmKCAiLnZhbGlkYXRlIiApDQoJCQkJLnJlbW92ZURhdGEoICJ2YWxpZGF0b3IiICkNCgkJCQkuZmluZCggIi52YWxpZGF0ZS1lcXVhbFRvLWJsdXIiICkNCgkJCQkJLm9mZiggIi52YWxpZGF0ZS1lcXVhbFRvIiApDQoJCQkJCS5yZW1vdmVDbGFzcyggInZhbGlkYXRlLWVxdWFsVG8tYmx1ciIgKTsNCgkJfQ0KDQoJfSwNCg0KCWNsYXNzUnVsZVNldHRpbmdzOiB7DQoJCXJlcXVpcmVkOiB7IHJlcXVpcmVkOiB0cnVlIH0sDQoJCWVtYWlsOiB7IGVtYWlsOiB0cnVlIH0sDQoJCXVybDogeyB1cmw6IHRydWUgfSwNCgkJZGF0ZTogeyBkYXRlOiB0cnVlIH0sDQoJCWRhdGVJU086IHsgZGF0ZUlTTzogdHJ1ZSB9LA0KCQludW1iZXI6IHsgbnVtYmVyOiB0cnVlIH0sDQoJCWRpZ2l0czogeyBkaWdpdHM6IHRydWUgfSwNCgkJY3JlZGl0Y2FyZDogeyBjcmVkaXRjYXJkOiB0cnVlIH0NCgl9LA0KDQoJYWRkQ2xhc3NSdWxlczogZnVuY3Rpb24oIGNsYXNzTmFtZSwgcnVsZXMgKSB7DQoJCWlmICggY2xhc3NOYW1lLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgKSB7DQoJCQl0aGlzLmNsYXNzUnVsZVNldHRpbmdzWyBjbGFzc05hbWUgXSA9IHJ1bGVzOw0KCQl9IGVsc2Ugew0KCQkJJC5leHRlbmQoIHRoaXMuY2xhc3NSdWxlU2V0dGluZ3MsIGNsYXNzTmFtZSApOw0KCQl9DQoJfSwNCg0KCWNsYXNzUnVsZXM6IGZ1bmN0aW9uKCBlbGVtZW50ICkgew0KCQl2YXIgcnVsZXMgPSB7fSwNCgkJCWNsYXNzZXMgPSAkKCBlbGVtZW50ICkuYXR0ciggImNsYXNzIiApOw0KDQoJCWlmICggY2xhc3NlcyApIHsNCgkJCSQuZWFjaCggY2xhc3Nlcy5zcGxpdCggIiAiICksIGZ1bmN0aW9uKCkgew0KCQkJCWlmICggdGhpcyBpbiAkLnZhbGlkYXRvci5jbGFzc1J1bGVTZXR0aW5ncyApIHsNCgkJCQkJJC5leHRlbmQoIHJ1bGVzLCAkLnZhbGlkYXRvci5jbGFzc1J1bGVTZXR0aW5nc1sgdGhpcyBdICk7DQoJCQkJfQ0KCQkJfSApOw0KCQl9DQoJCXJldHVybiBydWxlczsNCgl9LA0KDQoJbm9ybWFsaXplQXR0cmlidXRlUnVsZTogZnVuY3Rpb24oIHJ1bGVzLCB0eXBlLCBtZXRob2QsIHZhbHVlICkgew0KDQoJCS8vIENvbnZlcnQgdGhlIHZhbHVlIHRvIGEgbnVtYmVyIGZvciBudW1iZXIgaW5wdXRzLCBhbmQgZm9yIHRleHQgZm9yIGJhY2t3YXJkcyBjb21wYWJpbGl0eQ0KCQkvLyBhbGxvd3MgdHlwZT0iZGF0ZSIgYW5kIG90aGVycyB0byBiZSBjb21wYXJlZCBhcyBzdHJpbmdzDQoJCWlmICggL21pbnxtYXh8c3RlcC8udGVzdCggbWV0aG9kICkgJiYgKCB0eXBlID09PSBudWxsIHx8IC9udW1iZXJ8cmFuZ2V8dGV4dC8udGVzdCggdHlwZSApICkgKSB7DQoJCQl2YWx1ZSA9IE51bWJlciggdmFsdWUgKTsNCg0KCQkJLy8gU3VwcG9ydCBPcGVyYSBNaW5pLCB3aGljaCByZXR1cm5zIE5hTiBmb3IgdW5kZWZpbmVkIG1pbmxlbmd0aA0KCQkJaWYgKCBpc05hTiggdmFsdWUgKSApIHsNCgkJCQl2YWx1ZSA9IHVuZGVmaW5lZDsNCgkJCX0NCgkJfQ0KDQoJCWlmICggdmFsdWUgfHwgdmFsdWUgPT09IDAgKSB7DQoJCQlydWxlc1sgbWV0aG9kIF0gPSB2YWx1ZTsNCgkJfSBlbHNlIGlmICggdHlwZSA9PT0gbWV0aG9kICYmIHR5cGUgIT09ICJyYW5nZSIgKSB7DQoNCgkJCS8vIEV4Y2VwdGlvbjogdGhlIGpxdWVyeSB2YWxpZGF0ZSAncmFuZ2UnIG1ldGhvZA0KCQkJLy8gZG9lcyBub3QgdGVzdCBmb3IgdGhlIGh0bWw1ICdyYW5nZScgdHlwZQ0KCQkJcnVsZXNbIG1ldGhvZCBdID0gdHJ1ZTsNCgkJfQ0KCX0sDQoNCglhdHRyaWJ1dGVSdWxlczogZnVuY3Rpb24oIGVsZW1lbnQgKSB7DQoJCXZhciBydWxlcyA9IHt9LA0KCQkJJGVsZW1lbnQgPSAkKCBlbGVtZW50ICksDQoJCQl0eXBlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoICJ0eXBlIiApLA0KCQkJbWV0aG9kLCB2YWx1ZTsNCg0KCQlmb3IgKCBtZXRob2QgaW4gJC52YWxpZGF0b3IubWV0aG9kcyApIHsNCg0KCQkJLy8gU3VwcG9ydCBmb3IgPGlucHV0IHJlcXVpcmVkPiBpbiBib3RoIGh0bWw1IGFuZCBvbGRlciBicm93c2Vycw0KCQkJaWYgKCBtZXRob2QgPT09ICJyZXF1aXJlZCIgKSB7DQoJCQkJdmFsdWUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSggbWV0aG9kICk7DQoNCgkJCQkvLyBTb21lIGJyb3dzZXJzIHJldHVybiBhbiBlbXB0eSBzdHJpbmcgZm9yIHRoZSByZXF1aXJlZCBhdHRyaWJ1dGUNCgkJCQkvLyBhbmQgbm9uLUhUTUw1IGJyb3dzZXJzIG1pZ2h0IGhhdmUgcmVxdWlyZWQ9IiIgbWFya3VwDQoJCQkJaWYgKCB2YWx1ZSA9PT0gIiIgKSB7DQoJCQkJCXZhbHVlID0gdHJ1ZTsNCgkJCQl9DQoNCgkJCQkvLyBGb3JjZSBub24tSFRNTDUgYnJvd3NlcnMgdG8gcmV0dXJuIGJvb2wNCgkJCQl2YWx1ZSA9ICEhdmFsdWU7DQoJCQl9IGVsc2Ugew0KCQkJCXZhbHVlID0gJGVsZW1lbnQuYXR0ciggbWV0aG9kICk7DQoJCQl9DQoNCgkJCXRoaXMubm9ybWFsaXplQXR0cmlidXRlUnVsZSggcnVsZXMsIHR5cGUsIG1ldGhvZCwgdmFsdWUgKTsNCgkJfQ0KDQoJCS8vICdtYXhsZW5ndGgnIG1heSBiZSByZXR1cm5lZCBhcyAtMSwgMjE0NzQ4MzY0NyAoIElFICkgYW5kIDUyNDI4OCAoIHNhZmFyaSApIGZvciB0ZXh0IGlucHV0cw0KCQlpZiAoIHJ1bGVzLm1heGxlbmd0aCAmJiAvLTF8MjE0NzQ4MzY0N3w1MjQyODgvLnRlc3QoIHJ1bGVzLm1heGxlbmd0aCApICkgew0KCQkJZGVsZXRlIHJ1bGVzLm1heGxlbmd0aDsNCgkJfQ0KDQoJCXJldHVybiBydWxlczsNCgl9LA0KDQoJZGF0YVJ1bGVzOiBmdW5jdGlvbiggZWxlbWVudCApIHsNCgkJdmFyIHJ1bGVzID0ge30sDQoJCQkkZWxlbWVudCA9ICQoIGVsZW1lbnQgKSwNCgkJCXR5cGUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSggInR5cGUiICksDQoJCQltZXRob2QsIHZhbHVlOw0KDQoJCWZvciAoIG1ldGhvZCBpbiAkLnZhbGlkYXRvci5tZXRob2RzICkgew0KCQkJdmFsdWUgPSAkZWxlbWVudC5kYXRhKCAicnVsZSIgKyBtZXRob2QuY2hhckF0KCAwICkudG9VcHBlckNhc2UoKSArIG1ldGhvZC5zdWJzdHJpbmcoIDEgKS50b0xvd2VyQ2FzZSgpICk7DQoJCQl0aGlzLm5vcm1hbGl6ZUF0dHJpYnV0ZVJ1bGUoIHJ1bGVzLCB0eXBlLCBtZXRob2QsIHZhbHVlICk7DQoJCX0NCgkJcmV0dXJuIHJ1bGVzOw0KCX0sDQoNCglzdGF0aWNSdWxlczogZnVuY3Rpb24oIGVsZW1lbnQgKSB7DQoJCXZhciBydWxlcyA9IHt9LA0KCQkJdmFsaWRhdG9yID0gJC5kYXRhKCBlbGVtZW50LmZvcm0sICJ2YWxpZGF0b3IiICk7DQoNCgkJaWYgKCB2YWxpZGF0b3Iuc2V0dGluZ3MucnVsZXMgKSB7DQoJCQlydWxlcyA9ICQudmFsaWRhdG9yLm5vcm1hbGl6ZVJ1bGUoIHZhbGlkYXRvci5zZXR0aW5ncy5ydWxlc1sgZWxlbWVudC5uYW1lIF0gKSB8fCB7fTsNCgkJfQ0KCQlyZXR1cm4gcnVsZXM7DQoJfSwNCg0KCW5vcm1hbGl6ZVJ1bGVzOiBmdW5jdGlvbiggcnVsZXMsIGVsZW1lbnQgKSB7DQoNCgkJLy8gSGFuZGxlIGRlcGVuZGVuY3kgY2hlY2sNCgkJJC5lYWNoKCBydWxlcywgZnVuY3Rpb24oIHByb3AsIHZhbCApIHsNCg0KCQkJLy8gSWdub3JlIHJ1bGUgd2hlbiBwYXJhbSBpcyBleHBsaWNpdGx5IGZhbHNlLCBlZy4gcmVxdWlyZWQ6ZmFsc2UNCgkJCWlmICggdmFsID09PSBmYWxzZSApIHsNCgkJCQlkZWxldGUgcnVsZXNbIHByb3AgXTsNCgkJCQlyZXR1cm47DQoJCQl9DQoJCQlpZiAoIHZhbC5wYXJhbSB8fCB2YWwuZGVwZW5kcyApIHsNCgkJCQl2YXIga2VlcFJ1bGUgPSB0cnVlOw0KCQkJCXN3aXRjaCAoIHR5cGVvZiB2YWwuZGVwZW5kcyApIHsNCgkJCQljYXNlICJzdHJpbmciOg0KCQkJCQlrZWVwUnVsZSA9ICEhJCggdmFsLmRlcGVuZHMsIGVsZW1lbnQuZm9ybSApLmxlbmd0aDsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAiZnVuY3Rpb24iOg0KCQkJCQlrZWVwUnVsZSA9IHZhbC5kZXBlbmRzLmNhbGwoIGVsZW1lbnQsIGVsZW1lbnQgKTsNCgkJCQkJYnJlYWs7DQoJCQkJfQ0KCQkJCWlmICgga2VlcFJ1bGUgKSB7DQoJCQkJCXJ1bGVzWyBwcm9wIF0gPSB2YWwucGFyYW0gIT09IHVuZGVmaW5lZCA/IHZhbC5wYXJhbSA6IHRydWU7DQoJCQkJfSBlbHNlIHsNCgkJCQkJJC5kYXRhKCBlbGVtZW50LmZvcm0sICJ2YWxpZGF0b3IiICkucmVzZXRFbGVtZW50cyggJCggZWxlbWVudCApICk7DQoJCQkJCWRlbGV0ZSBydWxlc1sgcHJvcCBdOw0KCQkJCX0NCgkJCX0NCgkJfSApOw0KDQoJCS8vIEV2YWx1YXRlIHBhcmFtZXRlcnMNCgkJJC5lYWNoKCBydWxlcywgZnVuY3Rpb24oIHJ1bGUsIHBhcmFtZXRlciApIHsNCgkJCXJ1bGVzWyBydWxlIF0gPSAkLmlzRnVuY3Rpb24oIHBhcmFtZXRlciApICYmIHJ1bGUgIT09ICJub3JtYWxpemVyIiA/IHBhcmFtZXRlciggZWxlbWVudCApIDogcGFyYW1ldGVyOw0KCQl9ICk7DQoNCgkJLy8gQ2xlYW4gbnVtYmVyIHBhcmFtZXRlcnMNCgkJJC5lYWNoKCBbICJtaW5sZW5ndGgiLCAibWF4bGVuZ3RoIiBdLCBmdW5jdGlvbigpIHsNCgkJCWlmICggcnVsZXNbIHRoaXMgXSApIHsNCgkJCQlydWxlc1sgdGhpcyBdID0gTnVtYmVyKCBydWxlc1sgdGhpcyBdICk7DQoJCQl9DQoJCX0gKTsNCgkJJC5lYWNoKCBbICJyYW5nZWxlbmd0aCIsICJyYW5nZSIgXSwgZnVuY3Rpb24oKSB7DQoJCQl2YXIgcGFydHM7DQoJCQlpZiAoIHJ1bGVzWyB0aGlzIF0gKSB7DQoJCQkJaWYgKCAkLmlzQXJyYXkoIHJ1bGVzWyB0aGlzIF0gKSApIHsNCgkJCQkJcnVsZXNbIHRoaXMgXSA9IFsgTnVtYmVyKCBydWxlc1sgdGhpcyBdWyAwIF0gKSwgTnVtYmVyKCBydWxlc1sgdGhpcyBdWyAxIF0gKSBdOw0KCQkJCX0gZWxzZSBpZiAoIHR5cGVvZiBydWxlc1sgdGhpcyBdID09PSAic3RyaW5nIiApIHsNCgkJCQkJcGFydHMgPSBydWxlc1sgdGhpcyBdLnJlcGxhY2UoIC9bXFtcXV0vZywgIiIgKS5zcGxpdCggL1tccyxdKy8gKTsNCgkJCQkJcnVsZXNbIHRoaXMgXSA9IFsgTnVtYmVyKCBwYXJ0c1sgMCBdICksIE51bWJlciggcGFydHNbIDEgXSApIF07DQoJCQkJfQ0KCQkJfQ0KCQl9ICk7DQoNCgkJaWYgKCAkLnZhbGlkYXRvci5hdXRvQ3JlYXRlUmFuZ2VzICkgew0KDQoJCQkvLyBBdXRvLWNyZWF0ZSByYW5nZXMNCgkJCWlmICggcnVsZXMubWluICE9IG51bGwgJiYgcnVsZXMubWF4ICE9IG51bGwgKSB7DQoJCQkJcnVsZXMucmFuZ2UgPSBbIHJ1bGVzLm1pbiwgcnVsZXMubWF4IF07DQoJCQkJZGVsZXRlIHJ1bGVzLm1pbjsNCgkJCQlkZWxldGUgcnVsZXMubWF4Ow0KCQkJfQ0KCQkJaWYgKCBydWxlcy5taW5sZW5ndGggIT0gbnVsbCAmJiBydWxlcy5tYXhsZW5ndGggIT0gbnVsbCApIHsNCgkJCQlydWxlcy5yYW5nZWxlbmd0aCA9IFsgcnVsZXMubWlubGVuZ3RoLCBydWxlcy5tYXhsZW5ndGggXTsNCgkJCQlkZWxldGUgcnVsZXMubWlubGVuZ3RoOw0KCQkJCWRlbGV0ZSBydWxlcy5tYXhsZW5ndGg7DQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gcnVsZXM7DQoJfSwNCg0KCS8vIENvbnZlcnRzIGEgc2ltcGxlIHN0cmluZyB0byBhIHtzdHJpbmc6IHRydWV9IHJ1bGUsIGUuZy4sICJyZXF1aXJlZCIgdG8ge3JlcXVpcmVkOnRydWV9DQoJbm9ybWFsaXplUnVsZTogZnVuY3Rpb24oIGRhdGEgKSB7DQoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgew0KCQkJdmFyIHRyYW5zZm9ybWVkID0ge307DQoJCQkkLmVhY2goIGRhdGEuc3BsaXQoIC9ccy8gKSwgZnVuY3Rpb24oKSB7DQoJCQkJdHJhbnNmb3JtZWRbIHRoaXMgXSA9IHRydWU7DQoJCQl9ICk7DQoJCQlkYXRhID0gdHJhbnNmb3JtZWQ7DQoJCX0NCgkJcmV0dXJuIGRhdGE7DQoJfSwNCg0KCS8vIGh0dHBzOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvalF1ZXJ5LnZhbGlkYXRvci5hZGRNZXRob2QvDQoJYWRkTWV0aG9kOiBmdW5jdGlvbiggbmFtZSwgbWV0aG9kLCBtZXNzYWdlICkgew0KCQkkLnZhbGlkYXRvci5tZXRob2RzWyBuYW1lIF0gPSBtZXRob2Q7DQoJCSQudmFsaWRhdG9yLm1lc3NhZ2VzWyBuYW1lIF0gPSBtZXNzYWdlICE9PSB1bmRlZmluZWQgPyBtZXNzYWdlIDogJC52YWxpZGF0b3IubWVzc2FnZXNbIG5hbWUgXTsNCgkJaWYgKCBtZXRob2QubGVuZ3RoIDwgMyApIHsNCgkJCSQudmFsaWRhdG9yLmFkZENsYXNzUnVsZXMoIG5hbWUsICQudmFsaWRhdG9yLm5vcm1hbGl6ZVJ1bGUoIG5hbWUgKSApOw0KCQl9DQoJfSwNCg0KCS8vIGh0dHBzOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvalF1ZXJ5LnZhbGlkYXRvci5tZXRob2RzLw0KCW1ldGhvZHM6IHsNCg0KCQkvLyBodHRwczovL2pxdWVyeXZhbGlkYXRpb24ub3JnL3JlcXVpcmVkLW1ldGhvZC8NCgkJcmVxdWlyZWQ6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCwgcGFyYW0gKSB7DQoNCgkJCS8vIENoZWNrIGlmIGRlcGVuZGVuY3kgaXMgbWV0DQoJCQlpZiAoICF0aGlzLmRlcGVuZCggcGFyYW0sIGVsZW1lbnQgKSApIHsNCgkJCQlyZXR1cm4gImRlcGVuZGVuY3ktbWlzbWF0Y2giOw0KCQkJfQ0KCQkJaWYgKCBlbGVtZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJzZWxlY3QiICkgew0KDQoJCQkJLy8gQ291bGQgYmUgYW4gYXJyYXkgZm9yIHNlbGVjdC1tdWx0aXBsZSBvciBhIHN0cmluZywgYm90aCBhcmUgZmluZSB0aGlzIHdheQ0KCQkJCXZhciB2YWwgPSAkKCBlbGVtZW50ICkudmFsKCk7DQoJCQkJcmV0dXJuIHZhbCAmJiB2YWwubGVuZ3RoID4gMDsNCgkJCX0NCgkJCWlmICggdGhpcy5jaGVja2FibGUoIGVsZW1lbnQgKSApIHsNCgkJCQlyZXR1cm4gdGhpcy5nZXRMZW5ndGgoIHZhbHVlLCBlbGVtZW50ICkgPiAwOw0KCQkJfQ0KCQkJcmV0dXJuIHZhbHVlLmxlbmd0aCA+IDA7DQoJCX0sDQoNCgkJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9lbWFpbC1tZXRob2QvDQoJCWVtYWlsOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQgKSB7DQoNCgkJCS8vIEZyb20gaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvZm9ybXMuaHRtbCN2YWxpZC1lLW1haWwtYWRkcmVzcw0KCQkJLy8gUmV0cmlldmVkIDIwMTQtMDEtMTQNCgkJCS8vIElmIHlvdSBoYXZlIGEgcHJvYmxlbSB3aXRoIHRoaXMgaW1wbGVtZW50YXRpb24sIHJlcG9ydCBhIGJ1ZyBhZ2FpbnN0IHRoZSBhYm92ZSBzcGVjDQoJCQkvLyBPciB1c2UgY3VzdG9tIG1ldGhvZHMgdG8gaW1wbGVtZW50IHlvdXIgb3duIGVtYWlsIHZhbGlkYXRpb24NCgkJCXJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgL15bYS16QS1aMC05LiEjJCUmJyorXC89P15fYHt8fX4tXStAW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX1bYS16QS1aMC05XSk/KD86XC5bYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfVthLXpBLVowLTldKT8pKiQvLnRlc3QoIHZhbHVlICk7DQoJCX0sDQoNCgkJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy91cmwtbWV0aG9kLw0KCQl1cmw6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCApIHsNCg0KCQkJLy8gQ29weXJpZ2h0IChjKSAyMDEwLTIwMTMgRGllZ28gUGVyaW5pLCBNSVQgbGljZW5zZWQNCgkJCS8vIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL2RwZXJpbmkvNzI5Mjk0DQoJCQkvLyBzZWUgYWxzbyBodHRwczovL21hdGhpYXNieW5lbnMuYmUvZGVtby91cmwtcmVnZXgNCgkJCS8vIG1vZGlmaWVkIHRvIGFsbG93IHByb3RvY29sLXJlbGF0aXZlIFVSTHMNCgkJCXJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgL14oPzooPzooPzpodHRwcz98ZnRwKTopP1wvXC8pKD86XFMrKD86OlxTKik/QCk/KD86KD8hKD86MTB8MTI3KSg/OlwuXGR7MSwzfSl7M30pKD8hKD86MTY5XC4yNTR8MTkyXC4xNjgpKD86XC5cZHsxLDN9KXsyfSkoPyExNzJcLig/OjFbNi05XXwyXGR8M1swLTFdKSg/OlwuXGR7MSwzfSl7Mn0pKD86WzEtOV1cZD98MVxkXGR8MlswMV1cZHwyMlswLTNdKSg/OlwuKD86MT9cZHsxLDJ9fDJbMC00XVxkfDI1WzAtNV0pKXsyfSg/OlwuKD86WzEtOV1cZD98MVxkXGR8MlswLTRdXGR8MjVbMC00XSkpfCg/Oig/OlthLXpcdTAwYTEtXHVmZmZmMC05XS0qKSpbYS16XHUwMGExLVx1ZmZmZjAtOV0rKSg/OlwuKD86W2Etelx1MDBhMS1cdWZmZmYwLTldLSopKlthLXpcdTAwYTEtXHVmZmZmMC05XSspKig/OlwuKD86W2Etelx1MDBhMS1cdWZmZmZdezIsfSkpLj8pKD86OlxkezIsNX0pPyg/OlsvPyNdXFMqKT8kL2kudGVzdCggdmFsdWUgKTsNCgkJfSwNCg0KCQkvLyBodHRwczovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2RhdGUtbWV0aG9kLw0KCQlkYXRlOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQgKSB7DQoJCQlyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8ICEvSW52YWxpZHxOYU4vLnRlc3QoIG5ldyBEYXRlKCB2YWx1ZSApLnRvU3RyaW5nKCkgKTsNCgkJfSwNCg0KCQkvLyBodHRwczovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2RhdGVJU08tbWV0aG9kLw0KCQlkYXRlSVNPOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQgKSB7DQoJCQlyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8IC9eXGR7NH1bXC9cLV0oMD9bMS05XXwxWzAxMl0pW1wvXC1dKDA/WzEtOV18WzEyXVswLTldfDNbMDFdKSQvLnRlc3QoIHZhbHVlICk7DQoJCX0sDQoNCgkJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9udW1iZXItbWV0aG9kLw0KCQludW1iZXI6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCApIHsNCgkJCXJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgL14oPzotP1xkK3wtP1xkezEsM30oPzosXGR7M30pKyk/KD86XC5cZCspPyQvLnRlc3QoIHZhbHVlICk7DQoJCX0sDQoNCgkJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9kaWdpdHMtbWV0aG9kLw0KCQlkaWdpdHM6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCApIHsNCgkJCXJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgL15cZCskLy50ZXN0KCB2YWx1ZSApOw0KCQl9LA0KDQoJCS8vIGh0dHBzOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvbWlubGVuZ3RoLW1ldGhvZC8NCgkJbWlubGVuZ3RoOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQsIHBhcmFtICkgew0KCQkJdmFyIGxlbmd0aCA9ICQuaXNBcnJheSggdmFsdWUgKSA/IHZhbHVlLmxlbmd0aCA6IHRoaXMuZ2V0TGVuZ3RoKCB2YWx1ZSwgZWxlbWVudCApOw0KCQkJcmV0dXJuIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSB8fCBsZW5ndGggPj0gcGFyYW07DQoJCX0sDQoNCgkJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9tYXhsZW5ndGgtbWV0aG9kLw0KCQltYXhsZW5ndGg6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCwgcGFyYW0gKSB7DQoJCQl2YXIgbGVuZ3RoID0gJC5pc0FycmF5KCB2YWx1ZSApID8gdmFsdWUubGVuZ3RoIDogdGhpcy5nZXRMZW5ndGgoIHZhbHVlLCBlbGVtZW50ICk7DQoJCQlyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8IGxlbmd0aCA8PSBwYXJhbTsNCgkJfSwNCg0KCQkvLyBodHRwczovL2pxdWVyeXZhbGlkYXRpb24ub3JnL3JhbmdlbGVuZ3RoLW1ldGhvZC8NCgkJcmFuZ2VsZW5ndGg6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCwgcGFyYW0gKSB7DQoJCQl2YXIgbGVuZ3RoID0gJC5pc0FycmF5KCB2YWx1ZSApID8gdmFsdWUubGVuZ3RoIDogdGhpcy5nZXRMZW5ndGgoIHZhbHVlLCBlbGVtZW50ICk7DQoJCQlyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8ICggbGVuZ3RoID49IHBhcmFtWyAwIF0gJiYgbGVuZ3RoIDw9IHBhcmFtWyAxIF0gKTsNCgkJfSwNCg0KCQkvLyBodHRwczovL2pxdWVyeXZhbGlkYXRpb24ub3JnL21pbi1tZXRob2QvDQoJCW1pbjogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHsNCgkJCXJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgdmFsdWUgPj0gcGFyYW07DQoJCX0sDQoNCgkJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9tYXgtbWV0aG9kLw0KCQltYXg6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCwgcGFyYW0gKSB7DQoJCQlyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8IHZhbHVlIDw9IHBhcmFtOw0KCQl9LA0KDQoJCS8vIGh0dHBzOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvcmFuZ2UtbWV0aG9kLw0KCQlyYW5nZTogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHsNCgkJCXJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgKCB2YWx1ZSA+PSBwYXJhbVsgMCBdICYmIHZhbHVlIDw9IHBhcmFtWyAxIF0gKTsNCgkJfSwNCg0KCQkvLyBodHRwczovL2pxdWVyeXZhbGlkYXRpb24ub3JnL3N0ZXAtbWV0aG9kLw0KCQlzdGVwOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQsIHBhcmFtICkgew0KCQkJdmFyIHR5cGUgPSAkKCBlbGVtZW50ICkuYXR0ciggInR5cGUiICksDQoJCQkJZXJyb3JNZXNzYWdlID0gIlN0ZXAgYXR0cmlidXRlIG9uIGlucHV0IHR5cGUgIiArIHR5cGUgKyAiIGlzIG5vdCBzdXBwb3J0ZWQuIiwNCgkJCQlzdXBwb3J0ZWRUeXBlcyA9IFsgInRleHQiLCAibnVtYmVyIiwgInJhbmdlIiBdLA0KCQkJCXJlID0gbmV3IFJlZ0V4cCggIlxcYiIgKyB0eXBlICsgIlxcYiIgKSwNCgkJCQlub3RTdXBwb3J0ZWQgPSB0eXBlICYmICFyZS50ZXN0KCBzdXBwb3J0ZWRUeXBlcy5qb2luKCkgKSwNCgkJCQlkZWNpbWFsUGxhY2VzID0gZnVuY3Rpb24oIG51bSApIHsNCgkJCQkJdmFyIG1hdGNoID0gKCAiIiArIG51bSApLm1hdGNoKCAvKD86XC4oXGQrKSk/JC8gKTsNCgkJCQkJaWYgKCAhbWF0Y2ggKSB7DQoJCQkJCQlyZXR1cm4gMDsNCgkJCQkJfQ0KDQoJCQkJCS8vIE51bWJlciBvZiBkaWdpdHMgcmlnaHQgb2YgZGVjaW1hbCBwb2ludC4NCgkJCQkJcmV0dXJuIG1hdGNoWyAxIF0gPyBtYXRjaFsgMSBdLmxlbmd0aCA6IDA7DQoJCQkJfSwNCgkJCQl0b0ludCA9IGZ1bmN0aW9uKCBudW0gKSB7DQoJCQkJCXJldHVybiBNYXRoLnJvdW5kKCBudW0gKiBNYXRoLnBvdyggMTAsIGRlY2ltYWxzICkgKTsNCgkJCQl9LA0KCQkJCXZhbGlkID0gdHJ1ZSwNCgkJCQlkZWNpbWFsczsNCg0KCQkJLy8gV29ya3Mgb25seSBmb3IgdGV4dCwgbnVtYmVyIGFuZCByYW5nZSBpbnB1dCB0eXBlcw0KCQkJLy8gVE9ETyBmaW5kIGEgd2F5IHRvIHN1cHBvcnQgaW5wdXQgdHlwZXMgZGF0ZSwgZGF0ZXRpbWUsIGRhdGV0aW1lLWxvY2FsLCBtb250aCwgdGltZSBhbmQgd2Vlaw0KCQkJaWYgKCBub3RTdXBwb3J0ZWQgKSB7DQoJCQkJdGhyb3cgbmV3IEVycm9yKCBlcnJvck1lc3NhZ2UgKTsNCgkJCX0NCg0KCQkJZGVjaW1hbHMgPSBkZWNpbWFsUGxhY2VzKCBwYXJhbSApOw0KDQoJCQkvLyBWYWx1ZSBjYW4ndCBoYXZlIHRvbyBtYW55IGRlY2ltYWxzDQoJCQlpZiAoIGRlY2ltYWxQbGFjZXMoIHZhbHVlICkgPiBkZWNpbWFscyB8fCB0b0ludCggdmFsdWUgKSAlIHRvSW50KCBwYXJhbSApICE9PSAwICkgew0KCQkJCXZhbGlkID0gZmFsc2U7DQoJCQl9DQoNCgkJCXJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgdmFsaWQ7DQoJCX0sDQoNCgkJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9lcXVhbFRvLW1ldGhvZC8NCgkJZXF1YWxUbzogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHsNCg0KCQkJLy8gQmluZCB0byB0aGUgYmx1ciBldmVudCBvZiB0aGUgdGFyZ2V0IGluIG9yZGVyIHRvIHJldmFsaWRhdGUgd2hlbmV2ZXIgdGhlIHRhcmdldCBmaWVsZCBpcyB1cGRhdGVkDQoJCQl2YXIgdGFyZ2V0ID0gJCggcGFyYW0gKTsNCgkJCWlmICggdGhpcy5zZXR0aW5ncy5vbmZvY3Vzb3V0ICYmIHRhcmdldC5ub3QoICIudmFsaWRhdGUtZXF1YWxUby1ibHVyIiApLmxlbmd0aCApIHsNCgkJCQl0YXJnZXQuYWRkQ2xhc3MoICJ2YWxpZGF0ZS1lcXVhbFRvLWJsdXIiICkub24oICJibHVyLnZhbGlkYXRlLWVxdWFsVG8iLCBmdW5jdGlvbigpIHsNCgkJCQkJJCggZWxlbWVudCApLnZhbGlkKCk7DQoJCQkJfSApOw0KCQkJfQ0KCQkJcmV0dXJuIHZhbHVlID09PSB0YXJnZXQudmFsKCk7DQoJCX0sDQoNCgkJLy8gaHR0cHM6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9yZW1vdGUtbWV0aG9kLw0KCQlyZW1vdGU6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCwgcGFyYW0sIG1ldGhvZCApIHsNCgkJCWlmICggdGhpcy5vcHRpb25hbCggZWxlbWVudCApICkgew0KCQkJCXJldHVybiAiZGVwZW5kZW5jeS1taXNtYXRjaCI7DQoJCQl9DQoNCgkJCW1ldGhvZCA9IHR5cGVvZiBtZXRob2QgPT09ICJzdHJpbmciICYmIG1ldGhvZCB8fCAicmVtb3RlIjsNCg0KCQkJdmFyIHByZXZpb3VzID0gdGhpcy5wcmV2aW91c1ZhbHVlKCBlbGVtZW50LCBtZXRob2QgKSwNCgkJCQl2YWxpZGF0b3IsIGRhdGEsIG9wdGlvbkRhdGFTdHJpbmc7DQoNCgkJCWlmICggIXRoaXMuc2V0dGluZ3MubWVzc2FnZXNbIGVsZW1lbnQubmFtZSBdICkgew0KCQkJCXRoaXMuc2V0dGluZ3MubWVzc2FnZXNbIGVsZW1lbnQubmFtZSBdID0ge307DQoJCQl9DQoJCQlwcmV2aW91cy5vcmlnaW5hbE1lc3NhZ2UgPSBwcmV2aW91cy5vcmlnaW5hbE1lc3NhZ2UgfHwgdGhpcy5zZXR0aW5ncy5tZXNzYWdlc1sgZWxlbWVudC5uYW1lIF1bIG1ldGhvZCBdOw0KCQkJdGhpcy5zZXR0aW5ncy5tZXNzYWdlc1sgZWxlbWVudC5uYW1lIF1bIG1ldGhvZCBdID0gcHJldmlvdXMubWVzc2FnZTsNCg0KCQkJcGFyYW0gPSB0eXBlb2YgcGFyYW0gPT09ICJzdHJpbmciICYmIHsgdXJsOiBwYXJhbSB9IHx8IHBhcmFtOw0KCQkJb3B0aW9uRGF0YVN0cmluZyA9ICQucGFyYW0oICQuZXh0ZW5kKCB7IGRhdGE6IHZhbHVlIH0sIHBhcmFtLmRhdGEgKSApOw0KCQkJaWYgKCBwcmV2aW91cy5vbGQgPT09IG9wdGlvbkRhdGFTdHJpbmcgKSB7DQoJCQkJcmV0dXJuIHByZXZpb3VzLnZhbGlkOw0KCQkJfQ0KDQoJCQlwcmV2aW91cy5vbGQgPSBvcHRpb25EYXRhU3RyaW5nOw0KCQkJdmFsaWRhdG9yID0gdGhpczsNCgkJCXRoaXMuc3RhcnRSZXF1ZXN0KCBlbGVtZW50ICk7DQoJCQlkYXRhID0ge307DQoJCQlkYXRhWyBlbGVtZW50Lm5hbWUgXSA9IHZhbHVlOw0KCQkJJC5hamF4KCAkLmV4dGVuZCggdHJ1ZSwgew0KCQkJCW1vZGU6ICJhYm9ydCIsDQoJCQkJcG9ydDogInZhbGlkYXRlIiArIGVsZW1lbnQubmFtZSwNCgkJCQlkYXRhVHlwZTogImpzb24iLA0KCQkJCWRhdGE6IGRhdGEsDQoJCQkJY29udGV4dDogdmFsaWRhdG9yLmN1cnJlbnRGb3JtLA0KCQkJCXN1Y2Nlc3M6IGZ1bmN0aW9uKCByZXNwb25zZSApIHsNCgkJCQkJdmFyIHZhbGlkID0gcmVzcG9uc2UgPT09IHRydWUgfHwgcmVzcG9uc2UgPT09ICJ0cnVlIiwNCgkJCQkJCWVycm9ycywgbWVzc2FnZSwgc3VibWl0dGVkOw0KDQoJCQkJCXZhbGlkYXRvci5zZXR0aW5ncy5tZXNzYWdlc1sgZWxlbWVudC5uYW1lIF1bIG1ldGhvZCBdID0gcHJldmlvdXMub3JpZ2luYWxNZXNzYWdlOw0KCQkJCQlpZiAoIHZhbGlkICkgew0KCQkJCQkJc3VibWl0dGVkID0gdmFsaWRhdG9yLmZvcm1TdWJtaXR0ZWQ7DQoJCQkJCQl2YWxpZGF0b3IucmVzZXRJbnRlcm5hbHMoKTsNCgkJCQkJCXZhbGlkYXRvci50b0hpZGUgPSB2YWxpZGF0b3IuZXJyb3JzRm9yKCBlbGVtZW50ICk7DQoJCQkJCQl2YWxpZGF0b3IuZm9ybVN1Ym1pdHRlZCA9IHN1Ym1pdHRlZDsNCgkJCQkJCXZhbGlkYXRvci5zdWNjZXNzTGlzdC5wdXNoKCBlbGVtZW50ICk7DQoJCQkJCQl2YWxpZGF0b3IuaW52YWxpZFsgZWxlbWVudC5uYW1lIF0gPSBmYWxzZTsNCgkJCQkJCXZhbGlkYXRvci5zaG93RXJyb3JzKCk7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQllcnJvcnMgPSB7fTsNCgkJCQkJCW1lc3NhZ2UgPSByZXNwb25zZSB8fCB2YWxpZGF0b3IuZGVmYXVsdE1lc3NhZ2UoIGVsZW1lbnQsIHsgbWV0aG9kOiBtZXRob2QsIHBhcmFtZXRlcnM6IHZhbHVlIH0gKTsNCgkJCQkJCWVycm9yc1sgZWxlbWVudC5uYW1lIF0gPSBwcmV2aW91cy5tZXNzYWdlID0gbWVzc2FnZTsNCgkJCQkJCXZhbGlkYXRvci5pbnZhbGlkWyBlbGVtZW50Lm5hbWUgXSA9IHRydWU7DQoJCQkJCQl2YWxpZGF0b3Iuc2hvd0Vycm9ycyggZXJyb3JzICk7DQoJCQkJCX0NCgkJCQkJcHJldmlvdXMudmFsaWQgPSB2YWxpZDsNCgkJCQkJdmFsaWRhdG9yLnN0b3BSZXF1ZXN0KCBlbGVtZW50LCB2YWxpZCApOw0KCQkJCX0NCgkJCX0sIHBhcmFtICkgKTsNCgkJCXJldHVybiAicGVuZGluZyI7DQoJCX0NCgl9DQoNCn0gKTsNCg0KLy8gQWpheCBtb2RlOiBhYm9ydA0KLy8gdXNhZ2U6ICQuYWpheCh7IG1vZGU6ICJhYm9ydCJbLCBwb3J0OiAidW5pcXVlcG9ydCJdfSk7DQovLyBpZiBtb2RlOiJhYm9ydCIgaXMgdXNlZCwgdGhlIHByZXZpb3VzIHJlcXVlc3Qgb24gdGhhdCBwb3J0IChwb3J0IGNhbiBiZSB1bmRlZmluZWQpIGlzIGFib3J0ZWQgdmlhIFhNTEh0dHBSZXF1ZXN0LmFib3J0KCkNCg0KdmFyIHBlbmRpbmdSZXF1ZXN0cyA9IHt9LA0KCWFqYXg7DQoNCi8vIFVzZSBhIHByZWZpbHRlciBpZiBhdmFpbGFibGUgKDEuNSspDQppZiAoICQuYWpheFByZWZpbHRlciApIHsNCgkkLmFqYXhQcmVmaWx0ZXIoIGZ1bmN0aW9uKCBzZXR0aW5ncywgXywgeGhyICkgew0KCQl2YXIgcG9ydCA9IHNldHRpbmdzLnBvcnQ7DQoJCWlmICggc2V0dGluZ3MubW9kZSA9PT0gImFib3J0IiApIHsNCgkJCWlmICggcGVuZGluZ1JlcXVlc3RzWyBwb3J0IF0gKSB7DQoJCQkJcGVuZGluZ1JlcXVlc3RzWyBwb3J0IF0uYWJvcnQoKTsNCgkJCX0NCgkJCXBlbmRpbmdSZXF1ZXN0c1sgcG9ydCBdID0geGhyOw0KCQl9DQoJfSApOw0KfSBlbHNlIHsNCg0KCS8vIFByb3h5IGFqYXgNCglhamF4ID0gJC5hamF4Ow0KCSQuYWpheCA9IGZ1bmN0aW9uKCBzZXR0aW5ncyApIHsNCgkJdmFyIG1vZGUgPSAoICJtb2RlIiBpbiBzZXR0aW5ncyA/IHNldHRpbmdzIDogJC5hamF4U2V0dGluZ3MgKS5tb2RlLA0KCQkJcG9ydCA9ICggInBvcnQiIGluIHNldHRpbmdzID8gc2V0dGluZ3MgOiAkLmFqYXhTZXR0aW5ncyApLnBvcnQ7DQoJCWlmICggbW9kZSA9PT0gImFib3J0IiApIHsNCgkJCWlmICggcGVuZGluZ1JlcXVlc3RzWyBwb3J0IF0gKSB7DQoJCQkJcGVuZGluZ1JlcXVlc3RzWyBwb3J0IF0uYWJvcnQoKTsNCgkJCX0NCgkJCXBlbmRpbmdSZXF1ZXN0c1sgcG9ydCBdID0gYWpheC5hcHBseSggdGhpcywgYXJndW1lbnRzICk7DQoJCQlyZXR1cm4gcGVuZGluZ1JlcXVlc3RzWyBwb3J0IF07DQoJCX0NCgkJcmV0dXJuIGFqYXguYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOw0KCX07DQp9DQpyZXR1cm4gJDsNCn0pKTs=";
            var bytes = Convert.FromBase64String(s);
            return File(bytes, "text/javascript");
        }
    }
}